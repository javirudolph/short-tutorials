<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.36">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="javirudolph">

<title>Dynamic Multistate Occupancy Model</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="dyn_multistate_occ_overview_files/libs/clipboard/clipboard.min.js"></script>
<script src="dyn_multistate_occ_overview_files/libs/quarto-html/quarto.js"></script>
<script src="dyn_multistate_occ_overview_files/libs/quarto-html/popper.min.js"></script>
<script src="dyn_multistate_occ_overview_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="dyn_multistate_occ_overview_files/libs/quarto-html/anchor.min.js"></script>
<link href="dyn_multistate_occ_overview_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="dyn_multistate_occ_overview_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="dyn_multistate_occ_overview_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="dyn_multistate_occ_overview_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="dyn_multistate_occ_overview_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#source" id="toc-source" class="nav-link active" data-scroll-target="#source">Source</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#deriving-the-multi-state-occupancy-model" id="toc-deriving-the-multi-state-occupancy-model" class="nav-link" data-scroll-target="#deriving-the-multi-state-occupancy-model">Deriving the multi-state occupancy model</a></li>
  <li><a href="#simulation" id="toc-simulation" class="nav-link" data-scroll-target="#simulation">Simulation</a>
  <ul class="collapse">
  <li><a href="#simplest-case-no-dependency-of-parameters-on-site-survey-or-year" id="toc-simplest-case-no-dependency-of-parameters-on-site-survey-or-year" class="nav-link" data-scroll-target="#simplest-case-no-dependency-of-parameters-on-site-survey-or-year">Simplest case: no dependency of parameters on site, survey, or year</a>
  <ul class="collapse">
  <li><a href="#model-description" id="toc-model-description" class="nav-link" data-scroll-target="#model-description">Model description</a></li>
  <li><a href="#pick-parameters" id="toc-pick-parameters" class="nav-link" data-scroll-target="#pick-parameters">Pick parameters</a></li>
  <li><a href="#assembling" id="toc-assembling" class="nav-link" data-scroll-target="#assembling">Assembling</a></li>
  <li><a href="#simulation-1" id="toc-simulation-1" class="nav-link" data-scroll-target="#simulation-1">Simulation</a>
  <ul class="collapse">
  <li><a href="#empty-arrays" id="toc-empty-arrays" class="nav-link" data-scroll-target="#empty-arrays">Empty arrays</a></li>
  <li><a href="#initial-states-y1" id="toc-initial-states-y1" class="nav-link" data-scroll-target="#initial-states-y1">Initial states Y1</a></li>
  <li><a href="#states-z-matrix" id="toc-states-z-matrix" class="nav-link" data-scroll-target="#states-z-matrix">States Z matrix</a></li>
  <li><a href="#observations-y-matrix" id="toc-observations-y-matrix" class="nav-link" data-scroll-target="#observations-y-matrix">Observations Y matrix</a></li>
  </ul></li>
  <li><a href="#explore" id="toc-explore" class="nav-link" data-scroll-target="#explore">Explore</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#model-fitting" id="toc-model-fitting" class="nav-link" data-scroll-target="#model-fitting">Model fitting</a>
  <ul class="collapse">
  <li><a href="#static-single-season" id="toc-static-single-season" class="nav-link" data-scroll-target="#static-single-season">Static single-season</a>
  <ul class="collapse">
  <li><a href="#model-description-1" id="toc-model-description-1" class="nav-link" data-scroll-target="#model-description-1">Model description</a></li>
  <li><a href="#model-code" id="toc-model-code" class="nav-link" data-scroll-target="#model-code">Model code</a></li>
  <li><a href="#output-figures" id="toc-output-figures" class="nav-link" data-scroll-target="#output-figures">Output figures</a></li>
  <li><a href="#output-params" id="toc-output-params" class="nav-link" data-scroll-target="#output-params">Output params</a></li>
  </ul></li>
  <li><a href="#static-multi-season-model" id="toc-static-multi-season-model" class="nav-link" data-scroll-target="#static-multi-season-model">Static Multi-season model</a>
  <ul class="collapse">
  <li><a href="#model-description-2" id="toc-model-description-2" class="nav-link" data-scroll-target="#model-description-2">Model description</a></li>
  <li><a href="#model-code-1" id="toc-model-code-1" class="nav-link" data-scroll-target="#model-code-1">Model Code</a></li>
  <li><a href="#output-figures-1" id="toc-output-figures-1" class="nav-link" data-scroll-target="#output-figures-1">Output figures</a></li>
  <li><a href="#output-parameters" id="toc-output-parameters" class="nav-link" data-scroll-target="#output-parameters">Output parameters</a></li>
  </ul></li>
  <li><a href="#dynamic-multi-season-model" id="toc-dynamic-multi-season-model" class="nav-link" data-scroll-target="#dynamic-multi-season-model">Dynamic Multi-season Model</a>
  <ul class="collapse">
  <li><a href="#model-descritiption" id="toc-model-descritiption" class="nav-link" data-scroll-target="#model-descritiption">Model descritiption</a></li>
  <li><a href="#model" id="toc-model" class="nav-link" data-scroll-target="#model">Model</a></li>
  <li><a href="#output-figures-2" id="toc-output-figures-2" class="nav-link" data-scroll-target="#output-figures-2">Output figures</a></li>
  <li><a href="#params" id="toc-params" class="nav-link" data-scroll-target="#params">Params</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Dynamic Multistate Occupancy Model</h1>
<p class="subtitle lead">Calling this a self tutorial</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>javirudolph </p>
          </div>
  </div>
    
    
  </div>
  

</header>

<section id="source" class="level1">
<h1>Source</h1>
<p>I am following the Kery and Royle book, <a href="https://www.sciencedirect.com/book/9780128237687/applied-hierarchical-modeling-in-ecology-analysis-of-distribution-abundance-and-species-richness-in-r-and-bugs">Applied hierarchical modeling in Ecology</a>, Vol 2, Chapter 6. I am basically writing this document so that I understand what is going on in the book, and adapt it to my own work with bats. So, my references here will be to bats instead of birds, but I have deviated very little from the overall text in the book.</p>
</section>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>In multi-state models you distinguish between two or more states of an occupied site. For us, this means that each site (10x10 km grid) has multiple states: - Unoccupied or empty - Occupied by a few bats - Occupied by many bats</p>
<p>I imagine that if we wanted to add complexity, we could have occupied sites divided also between those with detected Pd or not, but for now, we will stick to having no bats, a few bats, many bats (states 1, 2, and 3).</p>
<p>The difference between a static and a dynamic model is that the first one estimates how sites are distributed among those different states, whereas for a dynamic model we also estimate a state transition probability matrix, which basically describes how each site goes from one state to another. It is this time dependency that is different. Below, when we fit the models to the simulated data, the static model will estimate parameters for each season, whereas the dynamic one will estimate those parameters as well, in addition to the parameters associated to how sites change from one season to another.</p>
<p>Dynamic multi-state models typically represented as state-space models: observation model, initial state, and probabilistic rule of how it changes over time in a Markovian manner (in our case dependency only on the last year, so not a full history dependence):</p>
<ol type="1">
<li>initial state vector <em>Omega</em> (<span class="math inline">\(\Omega\)</span>)<br>
</li>
<li>state transition probability matrix <em>Phi</em> (<span class="math inline">\(\Phi\)</span>)<br>
</li>
<li>observation matrix <em>Theta</em> (<span class="math inline">\(\Theta\)</span>)</li>
</ol>
</section>
<section id="deriving-the-multi-state-occupancy-model" class="level1">
<h1>Deriving the multi-state occupancy model</h1>
<p><strong>Question for experts: what would be the number of bats we are associating to these few bats and many bats? </strong></p>
<p>We have three different states, or two states of occupancy: <em>unoccupied</em> (coded as 1), <em>few bats</em> (coded as 2), <em>many bats</em> (coded as 3). For the observation data we will use <span class="math inline">\(y_{i,j,t}\)</span> where <span class="math inline">\(i\)</span> sites are identified (<span class="math inline">\(i = 1\dots M\)</span>) and <span class="math inline">\(j\)</span> is the index for surveys (<span class="math inline">\(j = 1\dots J\)</span>), and <span class="math inline">\(t\)</span> for time or year in our case (<span class="math inline">\(t = 1\dots T\)</span>). Keep in mind that <span class="math inline">\(y\)</span> are observed states, and the <em>true</em> state for each site is denoted by <span class="math inline">\(z\)</span>, which is modeled as a latent variable in the state model. The relationship between the true and observed states is described by the observation model.</p>
<p>To model the different occupancy states we use a Multinomial distribution, and for the first season of the dynamic model the state of a site is:</p>
<p><span class="math display">\[
z_i \sim Categorical(\Omega_i)
\]</span></p>
<p>where the state vector for site <span class="math inline">\(i\)</span> (<span class="math inline">\(\Omega_i\)</span>) has the probabilities with which site <span class="math inline">\(i\)</span> is in any of the three states described above:</p>
<p><span class="math display">\[
\Omega_i = [\phi_1 \quad \phi_2 \quad \phi_3]_i,
\]</span></p>
<p>and so the probability of site <span class="math inline">\(i\)</span> being in state <span class="math inline">\(s\)</span> is given by <span class="math inline">\(\phi_s\)</span>. Given that these are all probabilities, they are all values between 0 and 1, and together they sum up to 1. This means that we can express them in terms of another or reparameterize. This is necessary later on to reduce the number of parameters we estimate.</p>
<p>The observation model is able to link the true and observed state, and so it is also expressed as a Categorical distribution, conditional on the true state of the site. We write this:</p>
<p><span class="math display">\[
y_{i,j,t} | z_{i,t} \sim Categorical(\Theta_{z_i, o_{i,j}, i, j, t})
\]</span></p>
<p>The observation array (<span class="math inline">\(\Theta_{z_i, o_{i,j}, i, j, t}\)</span>) has five dimensions: the true state of site <span class="math inline">\(i\)</span> (<span class="math inline">\(z_i\)</span>), the observed state for the same site at survey <span class="math inline">\(j\)</span> (<span class="math inline">\(o_{i,j}\)</span>), the site <span class="math inline">\(i\)</span>, the survey <span class="math inline">\(j\)</span>, and the year <span class="math inline">\(t\)</span>. We can map the first two dimensions, which are probabilities, where the <strong>rows correspond to the true states, and the columns correspond to the observed states</strong> for a specific site, survey, and year (<span class="math inline">\(i,j,t\)</span>):</p>
<p><span class="math display">\[
\Theta_{z, o, i, j, t} = \begin{bmatrix}
                          p_{11} &amp; p_{12} &amp; p_{13}\\
                          p_{21} &amp; p_{22} &amp; p_{23}\\
                          p_{31} &amp; p_{32} &amp; p_{33}
                          \end{bmatrix}_{i,j,t}
\]</span></p>
<p>And so <span class="math inline">\(p_{11}\)</span> is the probability that an <em>unoccupied</em> site is observed as <em>unoccupied</em>. Similarly, <span class="math inline">\(p_{23}\)</span> is the probability that a site occupied by <em>few bats</em> (state 2) is observed as occupied by <em>many bats</em> (state 3); <em>this actually doesn’t make sense and so would be a zero</em>. Additionally, <span class="math inline">\(p_{12}\)</span> and <span class="math inline">\(p_{13}\)</span> are false-positive probabilities (if the site is unoccupied, then you wouldn’t be able to observe few or many bats). We can simplify this matrix as follows:</p>
<p><span class="math display">\[
\Theta_{z, o, i, j, t} = \begin{bmatrix}
                          1 &amp; 0 &amp; 0\\
                          1-p_{2} &amp; p_{2} &amp; 0\\
                          1-p_{32}-p_{33} &amp; p_{32} &amp; p_{33}
                          \end{bmatrix}_{i,j,t}
\]</span></p>
<p>However, if we think about more complex models, with more states, this way of simplifying might not be as useful. Alternatively, we can reparameterize that last row as a conditional Binomial, where <span class="math inline">\(p_3\)</span> is the probability of detecting any occupation at a site with many bats, and <span class="math inline">\(\delta\)</span> is the conditional probability of detecting <em>many bats</em> given detection:</p>
<p><span class="math display">\[
\Theta_{z, o, i, j, t} = \begin{bmatrix}
                          1 &amp; 0 &amp; 0\\
                          1-p_{2} &amp; p_{2} &amp; 0\\
                          1-p_{3} &amp; p_{3}(1-\delta) &amp; p_{3}\delta
                          \end{bmatrix}_{i,j,t}
\]</span></p>
<p>The last parameter here at [3,3] now reads that the probability of detecting many bats in a site with many bats (<span class="math inline">\(p_3 \delta\)</span>) is the probability of detecting bats at that site (<span class="math inline">\(p_3\)</span>), and that we detect <em>many bats</em> (<span class="math inline">\(\delta\)</span>). Also, <span class="math inline">\(p2\)</span> is the probability that we detect a <em>few bats</em> at a site that is occupied by a few bats.</p>
<p>Next, we describe the dynamics of the model by writing down the state transition probabilities (example would be a site going from unoccupied to having many bats from year 0 to year 1). For every transition at <span class="math inline">\(t = 2\dots T\)</span>, it depends on the previous year, and for every site we have:</p>
<p><span class="math display">\[
z_{i,t}|z_{i,t-1}\sim \Phi_{z{(t-1)}, z{(t)}, i,t}
\]</span></p>
<p>where the transition matrix is described by <span class="math inline">\(\Phi\)</span> (Phi). Keep in mind that the <span class="math inline">\(j\)</span> index is gone, because we are talking about <em>true</em> states here.</p>
<p><span class="math display">\[
\Phi_{z{(t-1)}, z{(t)}, i,t} =  \begin{bmatrix}
                                \pi_{11} &amp; \pi_{12} &amp; \pi_{13} \\
                                \pi_{21} &amp; \pi_{22} &amp; \pi_{23} \\
                                \pi_{31} &amp; \pi_{32} &amp; \pi_{33}
                                \end{bmatrix}_{i,t}
\]</span></p>
<p>we can read <span class="math inline">\(\pi_{n,m,i,t}\)</span> as the probability that site <span class="math inline">\(i\)</span> transitions from state <span class="math inline">\(n\)</span> in year <span class="math inline">\(t-1\)</span> to state <span class="math inline">\(m\)</span> in year <span class="math inline">\(t\)</span>. And we can also reparameterize this matrix.</p>
<p><span class="math display">\[
\Phi_{z{(t-1)}, z{(t)}, i,t} =  \begin{bmatrix}
                                1-\phi_1 &amp; \phi_1(1-\rho_1) &amp; \phi_1\rho_1 \\
                                1-\phi_2 &amp; \phi_2(1-\rho_2) &amp; \phi_2\rho_2 \\
                                1-\phi_3 &amp; \phi_3(1-\rho_3) &amp; \phi_3\rho_3
                                \end{bmatrix}_{i,t}
\]</span></p>
<p>Similarly as we did before, we want to simplify this matrix and reparameterize using another conditional binomial. We focus on having <span class="math inline">\(\phi_x\)</span> (phi) be the probability that site <span class="math inline">\(i\)</span> in state <span class="math inline">\(x\)</span> in year <span class="math inline">\(t-1\)</span> is occupied in year <span class="math inline">\(t\)</span>, and <span class="math inline">\(\rho_x\)</span> (rho) as the conditional probability that an occupied site has <em>many bats</em> (third state), not just a few, given that it was in state <span class="math inline">\(x\)</span> last year. In other words, <span class="math inline">\(\phi\)</span> is the probability of going from any state to being occupied, and <span class="math inline">\(\rho\)</span> is the probability that an occupied site has many bats this year given it has a few or many bats last year. As an example <span class="math inline">\(\phi_2(1-\rho_2)\)</span> is the probability that a site that was occupied by a few bats last year is still occupied this year (<span class="math inline">\(\phi_2\)</span>), and that given it is still occupied this year, that it has only a few bats (<span class="math inline">\(1-\rho_2\)</span>) instead of many bats (<span class="math inline">\(\rho_2\)</span>).</p>
<p>And we go back to this, where the observations are dependent on the underlying state, and that underlying state is dependent on the state of the previous year:</p>
<p><span class="math display">\[
y_{i,j,t} | z_{i,t} \sim Categorical(\Theta_{z_i, o_{i,j}, i, j, t})
\]</span></p>
<p>The observation at a given site, survey, and year is conditional on the true state of that site in that year.</p>
</section>
<section id="simulation" class="level1 page-columns page-full">
<h1>Simulation</h1>
<section id="simplest-case-no-dependency-of-parameters-on-site-survey-or-year" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="simplest-case-no-dependency-of-parameters-on-site-survey-or-year">Simplest case: no dependency of parameters on site, survey, or year</h2>
<section id="model-description" class="level3">
<h3 class="anchored" data-anchor-id="model-description">Model description</h3>
<p>Simulate data with three latent occupancy and three observation states, where the observation and transition matrices remain constant and are the same for all sites.</p>
<p><strong>True state</strong> on the initial year (<span class="math inline">\(z_{i,t}\)</span>) where <span class="math inline">\(t=1\)</span>. Here, for each site, the initial state is drawn according to the probabilities specified in <span class="math inline">\(\Omega\)</span>. So, the probability that a site in year 1 will be occupied (<span class="math inline">\(\psi\)</span>), and will also have many bats (<span class="math inline">\(r\)</span>) is determined by their product <span class="math inline">\(\psi r\)</span>.</p>
<p><span class="math display">\[
z_{i,1}\sim Categorical(\Omega), \text{with} \quad \Omega = [1-\psi \quad \psi(1-r) \quad \psi r]
\]</span></p>
<p><strong>Incorporating time</strong> with the transition matrix Phi (<span class="math inline">\(\Phi\)</span>). Notice the lack of sub indices for the matrix. This means that we use that same matrix for all years, meaning that the probability for sites to go from one state to another is the same every year. For example, if at year 3 we were to add bat boxes to empty sites to encourage a few bats moving in, then our transition matrix from year 3 might be different to the transition matrix in other years. In the case of year 3, we might change the values for <span class="math inline">\(\phi_1\)</span> since we will be increasing th probability that unoccupied sites will be occupied the next year.</p>
<p><span class="math display">\[
z_{i,t}|z_{i,t-1} \sim Categorical(\Phi_{z{(t-1)}, z{(t)}}),
\text{with} \quad
\Phi_{z{(t-1)}, z{(t)}} =  \begin{bmatrix}
                                1-\phi_1 &amp; \phi_1(1-\rho_1) &amp; \phi_1\rho_1 \\
                                1-\phi_2 &amp; \phi_2(1-\rho_2) &amp; \phi_2\rho_2 \\
                                1-\phi_3 &amp; \phi_3(1-\rho_3) &amp; \phi_3\rho_3
                                \end{bmatrix}
\]</span></p>
<p><strong>Observations</strong> are also not dependent on site, survey or year. So essentially, the probability that we observe a site given it’s latent state will remain the same. But, as an example, if we were to get more sensitive acoustic equipment that allows for better detection of a few bats, then perhaps our <span class="math inline">\(p2\)</span> would increase for those sites and years that have the more sensitive equipment.</p>
<p><span class="math display">\[
y_{i,j,t}|z_{i,t} \sim Categorical(\Theta_{z,o}), \text{with} \quad
\Theta_{z, o} = \begin{bmatrix}
                          1 &amp; 0 &amp; 0\\
                          1-p_{2} &amp; p_{2} &amp; 0\\
                          1-p_{32}-p_{33} &amp; p_{32} &amp; p_{33}
                          \end{bmatrix}
\]</span></p>
</section>
<section id="pick-parameters" class="level3">
<h3 class="anchored" data-anchor-id="pick-parameters">Pick parameters</h3>
<p>We pick parameters for <em>initial conditions first</em>, associated to <span class="math inline">\(\Omega\)</span>, thus we need to set <span class="math inline">\(\psi\)</span> and <span class="math inline">\(r\)</span> (To refresh <span class="math inline">\(\Omega = [1-\psi \quad \psi(1-r) \quad \psi r]\)</span>) to determine the probability of a site being empty, having a few bats, or many bats on the first year:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>psi <span class="ot">&lt;-</span> <span class="fl">0.5</span>    <span class="co"># Expected proportion of occupied sites</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fl">0.3</span>      <span class="co"># Proportion of those occupied sites that have many bats (third state)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Set parameters for the <em>transition matrix</em> (<span class="math inline">\(\Phi\)</span>). When we reparameterize, we set <span class="math inline">\(\phi_X\)</span> as the probability of becoming occupied given the site was in any of the three states the previous year, which is why we have three different probabilities; therefore, <span class="math inline">\(\phi_1\)</span> is the probability of becoming occupied given that the site was empty last year. For <span class="math inline">\(\rho_2\)</span> we would have the probability of having many bats this year given that last year the occupied site had a few bats.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Probability of becoming occupied</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>phi <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="co"># If the site was empty last year</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>         <span class="fl">0.5</span>, <span class="co"># If the site had a few bats last year</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>         <span class="fl">0.9</span>) <span class="co"># If the site had many bats last year</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Probability of having many bats if the site becomes occupied</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="co"># Very unlikely. If the site last year was empty, chance of it becoming occupied with many bats is kind of low</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>         <span class="fl">0.25</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>         <span class="fl">0.89</span>)   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Set parameters for the <strong>observation matrix</strong> (<span class="math inline">\(\Theta\)</span>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fl">0.5</span>   <span class="co"># Detection probability for a site with a few bats</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>p32 <span class="ot">&lt;-</span> <span class="fl">0.2</span>  <span class="co"># Classification probability of a site with many bats to be classified as with few bats</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>p33 <span class="ot">&lt;-</span> <span class="fl">0.8</span>  <span class="co"># Classification prob. of a site with many bats as having many bats</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="assembling" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="assembling">Assembling</h3>
<p>First, we can create our initial state probability vector (<span class="math inline">\(\Omega = [1-\psi \quad \psi(1-r) \quad \psi r]\)</span>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>Omega <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">-</span>psi, psi<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>r), psi<span class="sc">*</span>r)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>Omega</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.50 0.35 0.15</code></pre>
</div>
</div>
<p>which reads that the probability of a site’s initial state being <em>unoccupied</em> is 0.5, the probability of it being occupied by a <em>few bats</em> is 0.35, and the probability of it being occupied by <em>many bats</em> is 0.15. All for the first year.</p>
<p>Then, we build the transition matrix (<span class="math inline">\(\Phi\)</span>):</p>

<div class="no-row-height column-margin column-container"><div class="">
<p><span class="math display">\[
\Phi_{z{(t-1)}, z{(t)}} =  \begin{bmatrix}
                                1-\phi_1 &amp; \phi_1(1-\rho_1) &amp; \phi_1\rho_1 \\
                                1-\phi_2 &amp; \phi_2(1-\rho_2) &amp; \phi_2\rho_2 \\
                                1-\phi_3 &amp; \phi_3(1-\rho_3) &amp; \phi_3\rho_3
                                \end{bmatrix}
\]</span></p>
</div></div><div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>Phi <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">1</span><span class="sc">-</span>phi[<span class="dv">1</span>], phi[<span class="dv">1</span>]<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>rho[<span class="dv">1</span>]), phi[<span class="dv">1</span>]<span class="sc">*</span>rho[<span class="dv">1</span>],</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span><span class="sc">-</span>phi[<span class="dv">2</span>], phi[<span class="dv">2</span>]<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>rho[<span class="dv">2</span>]), phi[<span class="dv">2</span>]<span class="sc">*</span>rho[<span class="dv">2</span>],</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span><span class="sc">-</span>phi[<span class="dv">3</span>], phi[<span class="dv">3</span>]<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>rho[<span class="dv">3</span>]), phi[<span class="dv">3</span>]<span class="sc">*</span>rho[<span class="dv">3</span>]), <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>Phi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1]  [,2]  [,3]
[1,]  0.8 0.180 0.020
[2,]  0.5 0.375 0.125
[3,]  0.1 0.099 0.801</code></pre>
</div>
</div>
<p>The transition matrix also tells us the probability of a site staying the same, for example being <em>unoccupied</em> on year <span class="math inline">\(t\)</span> given that it was <em>unoccupied</em> on year <span class="math inline">\(t-1\)</span> is described by the (1,1) location on the matrix, (0.8).</p>
<p>And, our observation matrix (<span class="math inline">\(\Theta\)</span>):</p>

<div class="no-row-height column-margin column-container"><div class="">
<p><span class="math display">\[
\Theta_{z, o} = \begin{bmatrix}
                          1 &amp; 0 &amp; 0\\
                          1-p_{2} &amp; p_{2} &amp; 0\\
                          1-p_{32}-p_{33} &amp; p_{32} &amp; p_{33}
                          \end{bmatrix}
\]</span></p>
</div></div><div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>Theta <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span><span class="sc">-</span>p2, p2, <span class="dv">0</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span><span class="sc">-</span>p32<span class="sc">-</span>p33, p32, p33</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>Theta</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]  1.0  0.0  0.0
[2,]  0.5  0.5  0.0
[3,]  0.0  0.2  0.8</code></pre>
</div>
</div>
</section>
<section id="simulation-1" class="level3">
<h3 class="anchored" data-anchor-id="simulation-1">Simulation</h3>
<p>We will run a short simulation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>nsites <span class="ot">&lt;-</span> <span class="dv">40</span>     <span class="co"># Equivalent to "M"</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>nsurveys <span class="ot">&lt;-</span> <span class="dv">4</span>    <span class="co"># ... "J"</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>nyears <span class="ot">&lt;-</span> <span class="dv">8</span>       <span class="co"># ... "T"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="empty-arrays" class="level4">
<h4 class="anchored" data-anchor-id="empty-arrays">Empty arrays</h4>
<p>Here, we build empty arrays to hold all the information, one for the latent states (<span class="math inline">\(z\)</span>) and another for observations (<span class="math inline">\(y\)</span>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">NA</span>, <span class="at">dim =</span> <span class="fu">c</span>(nsites, nyears))</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(z) <span class="co"># every column is the year, and every row the site</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]   NA   NA   NA   NA   NA   NA   NA   NA
[2,]   NA   NA   NA   NA   NA   NA   NA   NA
[3,]   NA   NA   NA   NA   NA   NA   NA   NA
[4,]   NA   NA   NA   NA   NA   NA   NA   NA
[5,]   NA   NA   NA   NA   NA   NA   NA   NA
[6,]   NA   NA   NA   NA   NA   NA   NA   NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">NA</span>, <span class="at">dim =</span> <span class="fu">c</span>(nsites, nsurveys, nyears))</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(y) <span class="co"># here we have three dimensions. </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>, , 1

     [,1] [,2] [,3] [,4]
[1,]   NA   NA   NA   NA
[2,]   NA   NA   NA   NA
[3,]   NA   NA   NA   NA
[4,]   NA   NA   NA   NA
[5,]   NA   NA   NA   NA
[6,]   NA   NA   NA   NA

, , 2

     [,1] [,2] [,3] [,4]
[1,]   NA   NA   NA   NA
[2,]   NA   NA   NA   NA
[3,]   NA   NA   NA   NA
[4,]   NA   NA   NA   NA
[5,]   NA   NA   NA   NA
[6,]   NA   NA   NA   NA

, , 3

     [,1] [,2] [,3] [,4]
[1,]   NA   NA   NA   NA
[2,]   NA   NA   NA   NA
[3,]   NA   NA   NA   NA
[4,]   NA   NA   NA   NA
[5,]   NA   NA   NA   NA
[6,]   NA   NA   NA   NA

, , 4

     [,1] [,2] [,3] [,4]
[1,]   NA   NA   NA   NA
[2,]   NA   NA   NA   NA
[3,]   NA   NA   NA   NA
[4,]   NA   NA   NA   NA
[5,]   NA   NA   NA   NA
[6,]   NA   NA   NA   NA

, , 5

     [,1] [,2] [,3] [,4]
[1,]   NA   NA   NA   NA
[2,]   NA   NA   NA   NA
[3,]   NA   NA   NA   NA
[4,]   NA   NA   NA   NA
[5,]   NA   NA   NA   NA
[6,]   NA   NA   NA   NA

, , 6

     [,1] [,2] [,3] [,4]
[1,]   NA   NA   NA   NA
[2,]   NA   NA   NA   NA
[3,]   NA   NA   NA   NA
[4,]   NA   NA   NA   NA
[5,]   NA   NA   NA   NA
[6,]   NA   NA   NA   NA

, , 7

     [,1] [,2] [,3] [,4]
[1,]   NA   NA   NA   NA
[2,]   NA   NA   NA   NA
[3,]   NA   NA   NA   NA
[4,]   NA   NA   NA   NA
[5,]   NA   NA   NA   NA
[6,]   NA   NA   NA   NA

, , 8

     [,1] [,2] [,3] [,4]
[1,]   NA   NA   NA   NA
[2,]   NA   NA   NA   NA
[3,]   NA   NA   NA   NA
[4,]   NA   NA   NA   NA
[5,]   NA   NA   NA   NA
[6,]   NA   NA   NA   NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># An array for every year separately, where each column is the survey, and rows are sites.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="initial-states-y1" class="level4">
<h4 class="anchored" data-anchor-id="initial-states-y1">Initial states Y1</h4>
<p>So, what we want to do now is fill these arrays with numbers based on the probability values we set earlier, using a multinomial distribution and the probabilities we calculated for the initial state, transition, and observation matrices. As an example, we take the first year using the initial state vector <span class="math inline">\(\Omega\)</span> (Omega):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>rdraw <span class="ot">&lt;-</span> <span class="fu">rmultinom</span>(nsites, <span class="dv">1</span>, Omega)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>rdraw</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12] [,13] [,14]
[1,]    1    1    1    0    1    1    1    1    0     0     1     0     0     1
[2,]    0    0    0    0    0    0    0    0    1     1     0     1     1     0
[3,]    0    0    0    1    0    0    0    0    0     0     0     0     0     0
     [,15] [,16] [,17] [,18] [,19] [,20] [,21] [,22] [,23] [,24] [,25] [,26]
[1,]     0     0     0     0     1     0     0     1     1     1     0     1
[2,]     1     1     1     0     0     0     0     0     0     0     1     0
[3,]     0     0     0     1     0     1     1     0     0     0     0     0
     [,27] [,28] [,29] [,30] [,31] [,32] [,33] [,34] [,35] [,36] [,37] [,38]
[1,]     1     0     1     1     1     1     0     0     1     1     1     0
[2,]     0     1     0     0     0     0     1     1     0     0     0     1
[3,]     0     0     0     0     0     0     0     0     0     0     0     0
     [,39] [,40]
[1,]     0     0
[2,]     1     1
[3,]     0     0</code></pre>
</div>
</div>
<p>In the code above, each column represents a site (with a total of 40), and each row is the state. Thus, the firs row corresponds to <em>unoccupied</em>, second row for <em>few bats</em>, and third row for <em>many bats</em>. For this first year, the probability that each site falls under one of those states is given by <span class="math inline">\(\Omega\)</span>, that if we remember from above was a vector length three (one probability for each state) with the values 0.5, 0.35, 0.15</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This function is built in the book but I couldn't understand it at first. </span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># It basically asks, in which row is the number 1, versus the zeroes.</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># So we know the state for that site</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>get1<span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">which</span>(x<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># In this case, each site has the row number </span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co"># that corresponds to the state of the site (unoccupied, few bats, many bats)</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co"># we save this as the first column in our z array</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>z[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">apply</span>(rdraw, <span class="dv">2</span>, <span class="at">FUN =</span> get1)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>z[,<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1 1 1 3 1 1 1 1 2 2 1 2 2 1 2 2 2 3 1 3 3 1 1 1 2 1 1 2 1 1 1 1 2 2 1 1 1 2
[39] 2 2</code></pre>
</div>
</div>
<p>Let’s take a loot just at the first few sites so we can compare:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>rdraw[,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4] [,5]
[1,]    1    1    1    0    1
[2,]    0    0    0    0    0
[3,]    0    0    0    1    0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>z[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 1 1 3 1</code></pre>
</div>
</div>
<p>And also, since we have only done the first year, all the other years should be NAs:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(z)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    1   NA   NA   NA   NA   NA   NA   NA
[2,]    1   NA   NA   NA   NA   NA   NA   NA
[3,]    1   NA   NA   NA   NA   NA   NA   NA
[4,]    3   NA   NA   NA   NA   NA   NA   NA
[5,]    1   NA   NA   NA   NA   NA   NA   NA
[6,]    1   NA   NA   NA   NA   NA   NA   NA</code></pre>
</div>
</div>
</section>
<section id="states-z-matrix" class="level4">
<h4 class="anchored" data-anchor-id="states-z-matrix">States Z matrix</h4>
<p><strong>Fill in the true state for other years</strong>, but this time, we need to incorporate the state of the previous year. I am breaking up the code a little to explain it to myself. Take as an example the first site and second year:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># site 1</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="co">#second year</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And remember the transition probability matrix:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>Phi <span class="co"># Transition probability matrix</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1]  [,2]  [,3]
[1,]  0.8 0.180 0.020
[2,]  0.5 0.375 0.125
[3,]  0.1 0.099 0.801</code></pre>
</div>
</div>
<p>Now, find the state for the first site last year (on year 1):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>z[i, t<span class="dv">-1</span>] <span class="co"># the true state for site i last year</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<p>Given the state of that site last year, what are the probabilities of that site either staying the same or transitioning to the other two states:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>Phi[z[i, t<span class="dv">-1</span>],] <span class="co"># the vector of transition probabilities for a given state</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.80 0.18 0.02</code></pre>
</div>
</div>
<p>Now, we use those probabilities (of the site staying the same or transitioning to other states) to sample from a multinomial distribution and figure out what happens next:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>year_t <span class="ot">&lt;-</span> <span class="fu">rmultinom</span>(<span class="dv">1</span>,<span class="dv">1</span>, Phi[z[i, t<span class="dv">-1</span>],])</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>year_t</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1]
[1,]    1
[2,]    0
[3,]    0</code></pre>
</div>
</div>
<p>and we use the same function as before so it categorizes this as a 1, 2, or 3, for the site, depending on its true state,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get1</span>(year_t)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<p><strong>We can do this for all the sites and years</strong> using a for loop:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsites){</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(t <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>nyears){</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    z[i,t] <span class="ot">&lt;-</span> <span class="fu">get1</span>(<span class="fu">rmultinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, Phi[z[i, t<span class="dv">-1</span>],]))</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(z)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    1    1    1    2    1    2    1    1
[2,]    1    1    1    1    1    1    1    1
[3,]    1    2    1    2    1    1    1    1
[4,]    3    3    3    3    3    3    3    3
[5,]    1    2    1    1    1    1    1    1
[6,]    1    1    1    1    2    2    2    1</code></pre>
</div>
</div>
</section>
<section id="observations-y-matrix" class="level4">
<h4 class="anchored" data-anchor-id="observations-y-matrix">Observations Y matrix</h4>
<p>Finally, we get to <strong>the observations</strong>. Remember that each observation is conditional on the true underlying state (<span class="math inline">\(z\)</span>, what we just simulated above). We use the observation matrix (<span class="math inline">\(\Theta\)</span>) here. Later on, these probabilities for the observation matrix depend on different detection covariates. To refresh, we set the observation matrix to:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>Theta</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]  1.0  0.0  0.0
[2,]  0.5  0.5  0.0
[3,]  0.0  0.2  0.8</code></pre>
</div>
</div>
<p>First row reads <em>that the probability of observing a site as unoccupied, given that it’s true state is unoccupied equals 1</em>. The second row then says that given that a site has a <em>few bats</em>, we can either observe it as unoccupied or as occupied by a few bats with a 50:50 chance. And finally, the third row, for a site with <em>many bats</em>, the probability of observing no bats is 0, of observing a few bats is 0.2, or observing many bats is 0.8.</p>
<p>As an example then, if we consider the first site on the first year</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>z[<span class="dv">1</span>,<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<p>then, we ask, what is the probability of seeing no bats, few bats, or many bats, given that the true underlying state is many bats?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>Theta[z[<span class="dv">1</span>,<span class="dv">1</span>],]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 0 0</code></pre>
</div>
</div>
<p>and so, the realization of this random process for the 4 surveys would look like:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>surveydraw <span class="ot">&lt;-</span> <span class="fu">rmultinom</span>(nsurveys, <span class="dv">1</span>, Theta[z[<span class="dv">1</span>,<span class="dv">1</span>],])</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>surveydraw</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4]
[1,]    1    1    1    1
[2,]    0    0    0    0
[3,]    0    0    0    0</code></pre>
</div>
</div>
<p>We do this for all sites and years:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsites){</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(t <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nyears){</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    y[i,,t] <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">rmultinom</span>(nsurveys, <span class="dv">1</span>, Theta[z[i,t],]), <span class="dv">2</span>, get1)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Example of the first site</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>y[<span class="dv">1</span>,,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    1    1    1    1    1    2    1    1
[2,]    1    1    1    2    1    1    1    1
[3,]    1    1    1    2    1    2    1    1
[4,]    1    1    1    2    1    2    1    1</code></pre>
</div>
</div>
</section>
</section>
<section id="explore" class="level3">
<h3 class="anchored" data-anchor-id="explore">Explore</h3>
<p>We can explore some sites, for example below you will see the state during the five years for the first six sites:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(z)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    1    1    1    2    1    2    1    1
[2,]    1    1    1    1    1    1    1    1
[3,]    1    2    1    2    1    1    1    1
[4,]    3    3    3    3    3    3    3    3
[5,]    1    2    1    1    1    1    1    1
[6,]    1    1    1    1    2    2    2    1</code></pre>
</div>
</div>
<p>we can focus on the second row, site 2, and we see that for the first two years the site had (<em>a few bats</em>), then on years three and four, it gets occupied by <em>many bats</em> and year five through seven, there’s a decline to no bats, and then the last year we have a few bats again.</p>
<p>Our observations for site 2 are shown below, where each row is a survey, and the columns correspond to each year. If we had perfect detection, each row should look the same as the second row in the matrix above.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>y[<span class="dv">2</span>,,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    1    1    1    1    1    1    1    1
[2,]    1    1    1    1    1    1    1    1
[3,]    1    1    1    1    1    1    1    1
[4,]    1    1    1    1    1    1    1    1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># save these for later</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">save.image</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="model-fitting" class="level1">
<h1>Model fitting</h1>
<section id="static-single-season" class="level2">
<h2 class="anchored" data-anchor-id="static-single-season">Static single-season</h2>
<section id="model-description-1" class="level3">
<h3 class="anchored" data-anchor-id="model-description-1">Model description</h3>
<p>So, in this case we are only taking data from the first year, which means no estimating parameters of the transition matrix, etc. We basically just take a snapshot and we care about estimating the parameters associated to the state and the observation. The question it asks is, what is the occupancy for a site now? I think this is what it does:</p>
<p>The underlying true state:</p>
<p><span class="math display">\[
z_i \sim Categorical(\Omega) \quad \text{with} \quad \Omega = [1-\psi \quad \psi(1-r) \quad \psi r]
\]</span></p>
<p>And the observations given that state for each site:</p>
<p><span class="math display">\[
y_i|z_i \sim Categorical(\Theta) \quad \text{with} \quad
\Theta_{z, o} = \begin{bmatrix}
                          1 &amp; 0 &amp; 0\\
                          1-p_{2} &amp; p_{2} &amp; 0\\
                          1-p_{32}-p_{33} &amp; p_{32} &amp; p_{33}
                          \end{bmatrix}
\]</span></p>
<p>If you count the number of parameters here, I think we are trying to estimate only 5: <span class="math inline">\(\psi\)</span>, <span class="math inline">\(r\)</span>, <span class="math inline">\(p_2\)</span>, <span class="math inline">\(p_{32}\)</span>, <span class="math inline">\(p_{33}\)</span> , since <span class="math inline">\(p_{31} = 1-p_{32}-p_{33}\)</span>.</p>
<p>The model to fit this uses a Gaussian prior for the logit of <span class="math inline">\(p32\)</span> and <span class="math inline">\(p33\)</span> so that it allows for the modeling of covariates (which we are not doing here) but it would look like this:</p>
<p>The priors:</p>
<p><span class="math display">\[
lp_{32} \sim Normal(0,0.001)\\
lp_{33} \sim Normal(0,0.001)
\]</span></p>
<p>The multinomial link:</p>
<p><span class="math display">\[
p_{32} = \exp(lp_{32})/(1+\exp(lp_{32}) + \exp(lp_{33})) \\
p_{33} = \exp(lp_{33})/(1+\exp(lp_{32}) + \exp(lp_{33}))
\]</span></p>
<p>So that we could do GLM type things:</p>
<p><span class="math display">\[
lp_{32} = \alpha_1 + \beta_1 * X + \epsilon_1 \\
lp_{33} = \alpha_2 + \beta_2 * X + \epsilon_2
\]</span></p>
</section>
<section id="model-code" class="level3">
<h3 class="anchored" data-anchor-id="model-code">Model code</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get data for one year</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(y1 <span class="ot">&lt;-</span> y[,,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> int [1:40, 1:4] 1 1 1 3 1 1 1 1 2 2 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tabulate observed data for each site</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>ttab <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim =</span> <span class="fu">c</span>(nsites, <span class="dv">3</span>)) <span class="co"># sites by number of states</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ttab) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'nobats'</span>, <span class="st">'fewbats'</span>, <span class="st">'manybats'</span>)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsites){</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  tt <span class="ot">&lt;-</span> <span class="fu">table</span>(y1[i,])</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  ttab[i, <span class="fu">as.numeric</span>(<span class="fu">names</span>(tt))] <span class="ot">&lt;-</span> tt</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ttab) <span class="co"># guessing sum of the row should be 3, for the three surveys</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     nobats fewbats manybats
[1,]      4       0        0
[2,]      4       0        0
[3,]      4       0        0
[4,]      0       1        3
[5,]      4       0        0
[6,]      4       0        0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compare to the true state and summary of observed states</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">data.frame</span>(<span class="st">'truestate'</span> <span class="ot">=</span> z[,<span class="dv">1</span>], ttab))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  truestate nobats fewbats manybats
1         1      4       0        0
2         1      4       0        0
3         1      4       0        0
4         3      0       1        3
5         1      4       0        0
6         1      4       0        0</code></pre>
</div>
</div>
<p>Getting to fit the data, lets see if this works or not.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bundle data</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(bdata <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">y =</span> y1, <span class="at">nsites =</span> <span class="fu">nrow</span>(y1), <span class="at">nsurveys =</span> <span class="fu">ncol</span>(y1)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 3
 $ y       : int [1:40, 1:4] 1 1 1 3 1 1 1 1 2 2 ...
 $ nsites  : int 40
 $ nsurveys: int 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify model</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="at">file =</span> <span class="st">'../dyn_multistate_occu/static1.txt'</span>, <span class="st">"</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="st">    model {</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="st">    # Priors</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="st">    psi ~ dunif(0,1)</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="st">    r ~ dunif(0,1)</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a><span class="st">    p2 ~ dunif(0,1)</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a><span class="st">    # Multinomial logit link for observation model for state 3 (many bats)</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a><span class="st">    lp32 ~ dnorm(0, 0.001)</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a><span class="st">    lp33 ~ dnorm(0, 0.001)</span></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a><span class="st">    p32 &lt;- exp(lp32) / (1 + exp(lp32) + exp(lp33))</span></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a><span class="st">    p33 &lt;- exp(lp33) / (1 + exp(lp32) + exp(lp33))</span></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a><span class="st">    p31 &lt;- 1-p32-p33</span></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a><span class="st">    # Define initial state vector Omega</span></span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a><span class="st">    Omega[1] &lt;- 1 - psi</span></span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a><span class="st">    Omega[2] &lt;- psi * (1-r)</span></span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a><span class="st">    Omega[3] &lt;- psi * r</span></span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a><span class="st">    # Define observation matrix</span></span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a><span class="st">    Theta[1,1] &lt;- 1</span></span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a><span class="st">    Theta[1,2] &lt;- 0</span></span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a><span class="st">    Theta[1,3] &lt;- 0</span></span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a><span class="st">    Theta[2,1] &lt;- 1-p2</span></span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a><span class="st">    Theta[2,2] &lt;- p2</span></span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a><span class="st">    Theta[2,3] &lt;- 0</span></span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true" tabindex="-1"></a><span class="st">    Theta[3,1] &lt;- p31</span></span>
<span id="cb62-30"><a href="#cb62-30" aria-hidden="true" tabindex="-1"></a><span class="st">    Theta[3,2] &lt;- p32</span></span>
<span id="cb62-31"><a href="#cb62-31" aria-hidden="true" tabindex="-1"></a><span class="st">    Theta[3,3] &lt;- p33</span></span>
<span id="cb62-32"><a href="#cb62-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-33"><a href="#cb62-33" aria-hidden="true" tabindex="-1"></a><span class="st">    # State-space likelihood</span></span>
<span id="cb62-34"><a href="#cb62-34" aria-hidden="true" tabindex="-1"></a><span class="st">    # State equation: the true states</span></span>
<span id="cb62-35"><a href="#cb62-35" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:nsites) {</span></span>
<span id="cb62-36"><a href="#cb62-36" aria-hidden="true" tabindex="-1"></a><span class="st">    z[i] ~ dcat(Omega[])</span></span>
<span id="cb62-37"><a href="#cb62-37" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb62-38"><a href="#cb62-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-39"><a href="#cb62-39" aria-hidden="true" tabindex="-1"></a><span class="st">    # Observation equation</span></span>
<span id="cb62-40"><a href="#cb62-40" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:nsites) {</span></span>
<span id="cb62-41"><a href="#cb62-41" aria-hidden="true" tabindex="-1"></a><span class="st">      for (j in 1:nsurveys) {</span></span>
<span id="cb62-42"><a href="#cb62-42" aria-hidden="true" tabindex="-1"></a><span class="st">      y[i,j] ~ dcat(Theta[z[i],])</span></span>
<span id="cb62-43"><a href="#cb62-43" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb62-44"><a href="#cb62-44" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb62-45"><a href="#cb62-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-46"><a href="#cb62-46" aria-hidden="true" tabindex="-1"></a><span class="st">    # Derived quantities</span></span>
<span id="cb62-47"><a href="#cb62-47" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:nsites) {</span></span>
<span id="cb62-48"><a href="#cb62-48" aria-hidden="true" tabindex="-1"></a><span class="st">      occ1[i] &lt;- equals(z[i], 1)</span></span>
<span id="cb62-49"><a href="#cb62-49" aria-hidden="true" tabindex="-1"></a><span class="st">      occ2[i] &lt;- equals(z[i], 2)</span></span>
<span id="cb62-50"><a href="#cb62-50" aria-hidden="true" tabindex="-1"></a><span class="st">      occ3[i] &lt;- equals(z[i], 3)</span></span>
<span id="cb62-51"><a href="#cb62-51" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb62-52"><a href="#cb62-52" aria-hidden="true" tabindex="-1"></a><span class="st">    n.occ[1] &lt;- sum(occ1[]) # Total number of sites in state 1</span></span>
<span id="cb62-53"><a href="#cb62-53" aria-hidden="true" tabindex="-1"></a><span class="st">    n.occ[2] &lt;- sum(occ2[])</span></span>
<span id="cb62-54"><a href="#cb62-54" aria-hidden="true" tabindex="-1"></a><span class="st">    n.occ[3] &lt;- sum(occ3[])</span></span>
<span id="cb62-55"><a href="#cb62-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-56"><a href="#cb62-56" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb62-57"><a href="#cb62-57" aria-hidden="true" tabindex="-1"></a><span class="st">    "</span>)</span>
<span id="cb62-58"><a href="#cb62-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-59"><a href="#cb62-59" aria-hidden="true" tabindex="-1"></a><span class="co"># The previous chunk just gets the model saves as a text file in this directory</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initial values</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>zst <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">3</span>, <span class="fu">nrow</span>(bdata<span class="sc">$</span>y)) <span class="co"># initialize at highest possible state</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>inits <span class="ot">&lt;-</span> <span class="cf">function</span>() {<span class="fu">list</span>(</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">z =</span> zst</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  )}</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters monitored</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"psi"</span>, <span class="st">"r"</span>, <span class="st">"p2"</span>, <span class="st">"p31"</span>, <span class="st">"p32"</span>, <span class="st">"p33"</span>, <span class="st">"Omega"</span>, <span class="st">"Theta"</span>, <span class="st">"n.occ"</span>)</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a><span class="co"># MCMC settings</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>na <span class="ot">&lt;-</span> <span class="dv">1000</span> ; ni <span class="ot">&lt;-</span> <span class="dv">2000</span> ; nt <span class="ot">&lt;-</span> <span class="dv">2</span> ; nb <span class="ot">&lt;-</span> <span class="dv">1000</span> ; nc <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Call JAGS</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jagsUI)</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>out1 <span class="ot">&lt;-</span> <span class="fu">jags</span>(bdata, inits, params, <span class="st">"../dyn_multistate_occu/static1.txt"</span>, <span class="at">n.adapt =</span> na, <span class="at">n.chains =</span> nc, <span class="at">n.thin =</span> nt, <span class="at">n.iter =</span> ni, <span class="at">n.burnin =</span> nb,</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">parallel =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Processing function input....... 

Done. 
 
Beginning parallel processing using 3 cores. Console output will be suppressed.

Parallel processing completed.

Calculating statistics....... </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in doTryCatch(return(expr), name, parentenv, handler): At least one Rhat
value could not be calculated.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Done. </code></pre>
</div>
</div>
</section>
<section id="output-figures" class="level3">
<h3 class="anchored" data-anchor-id="output-figures">Output figures</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>))</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">traceplot</span>(out1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="dyn_multistate_occ_overview_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="dyn_multistate_occ_overview_files/figure-html/unnamed-chunk-31-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="dyn_multistate_occ_overview_files/figure-html/unnamed-chunk-31-3.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="output-params" class="level3">
<h3 class="anchored" data-anchor-id="output-params">Output params</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(out1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>JAGS output for model '../dyn_multistate_occu/static1.txt', generated by jagsUI.
Estimates based on 3 chains of 2000 iterations,
adaptation = 1000 iterations (sufficient),
burn-in = 1000 iterations and thin rate = 2,
yielding 1500 total samples from the joint posterior. 
MCMC ran in parallel for 0.042 minutes at time 2022-09-14 15:58:27.

              mean    sd   2.5%    50%   97.5% overlap0 f  Rhat n.eff
psi          0.480 0.081  0.331  0.478   0.649    FALSE 1 1.001  1500
r            0.239 0.093  0.089  0.231   0.451    FALSE 1 1.002   802
p2           0.494 0.076  0.341  0.492   0.643    FALSE 1 1.004   436
p31          0.000 0.002  0.000  0.000   0.002     TRUE 1 1.317    64
p32          0.204 0.108  0.048  0.188   0.449    FALSE 1 1.004   840
p33          0.796 0.108  0.551  0.812   0.951    FALSE 1 1.004   955
Omega[1]     0.520 0.081  0.351  0.522   0.669    FALSE 1 1.001  1500
Omega[2]     0.366 0.081  0.221  0.363   0.532    FALSE 1 1.003  1500
Omega[3]     0.114 0.046  0.037  0.109   0.217    FALSE 1 1.003   641
Theta[1,1]   1.000 0.000  1.000  1.000   1.000    FALSE 1    NA     1
Theta[2,1]   0.506 0.076  0.357  0.508   0.659    FALSE 1 1.004   436
Theta[3,1]   0.000 0.002  0.000  0.000   0.002     TRUE 1 1.317    64
Theta[1,2]   0.000 0.000  0.000  0.000   0.000    FALSE 1    NA     1
Theta[2,2]   0.494 0.076  0.341  0.492   0.643    FALSE 1 1.004   436
Theta[3,2]   0.204 0.108  0.048  0.188   0.449    FALSE 1 1.004   840
Theta[1,3]   0.000 0.000  0.000  0.000   0.000    FALSE 1    NA     1
Theta[2,3]   0.000 0.000  0.000  0.000   0.000    FALSE 1    NA     1
Theta[3,3]   0.796 0.108  0.551  0.812   0.951    FALSE 1 1.004   955
n.occ[1]    20.831 1.431 17.000 21.000  22.000    FALSE 1 1.027   207
n.occ[2]    15.095 1.417 14.000 15.000  19.000    FALSE 1 1.026   190
n.occ[3]     4.074 0.300  4.000  4.000   5.000    FALSE 1 1.000  1500
deviance   101.436 7.480 92.963 99.772 119.632    FALSE 1 1.017   241

**WARNING** Rhat values indicate convergence failure. 
Rhat is the potential scale reduction factor (at convergence, Rhat=1). 
For each parameter, n.eff is a crude measure of effective sample size. 

overlap0 checks if 0 falls in the parameter's 95% credible interval.
f is the proportion of the posterior with the same sign as the mean;
i.e., our confidence that the parameter is positive or negative.

DIC info: (pD = var(deviance)/2) 
pD = 27.8 and DIC = 129.215 
DIC is an estimate of expected predictive error (lower is better).</code></pre>
</div>
</div>
</section>
</section>
<section id="static-multi-season-model" class="level2">
<h2 class="anchored" data-anchor-id="static-multi-season-model">Static Multi-season model</h2>
<section id="model-description-2" class="level3">
<h3 class="anchored" data-anchor-id="model-description-2">Model description</h3>
<p>The next logical step is to consider all the years. So, previously we took only the data for the first year, and now we will use all the years for this, and fit separate parameters for each year. Now, the state for each site varies by year, with year-specific <span class="math inline">\(\psi\)</span> and <span class="math inline">\(r\)</span> parameters, but we don’t consider here any transition probabilities.</p>
<p>The underlying state now has time, so it looks like this:</p>
<p><span class="math display">\[
z_{i,t}\sim Categorical(\Omega_t), \text{with} \quad \Omega_t = [1-\psi_t \quad \psi_t(1-r_t) \quad \psi_t r_t]
\]</span></p>
<p>And observations given by:</p>
<p><span class="math display">\[
y_{i,j,t}|z_{i,t} \sim Categorical(\Theta_{z,o,i,j,t}), \text{with} \quad
\Theta_{z, o,i,j,t} = \begin{bmatrix}
                          1 &amp; 0 &amp; 0\\
                          1-p_{2}t &amp; p_{2} &amp; 0\\
                          1-p_{32}-p_{33} &amp; p_{32} &amp; p_{33}
                          \end{bmatrix}_{i,j,t}
\]</span></p>
</section>
<section id="model-code-1" class="level3">
<h3 class="anchored" data-anchor-id="model-code-1">Model Code</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bundle data</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(bdata <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">y =</span> y, <span class="at">nsites =</span> <span class="fu">dim</span>(y)[<span class="dv">1</span>], <span class="at">nsurveys =</span> <span class="fu">dim</span>(y)[<span class="dv">2</span>], <span class="at">nyears =</span> <span class="fu">dim</span>(y)[<span class="dv">3</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 4
 $ y       : int [1:40, 1:4, 1:8] 1 1 1 3 1 1 1 1 2 2 ...
 $ nsites  : int 40
 $ nsurveys: int 4
 $ nyears  : int 8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We specify the model</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="at">file =</span> <span class="st">'../dyn_multistate_occu/static2.txt'</span>, <span class="st">"</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="st">    model {</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="st">    # Priors for each year (you will notice these are the same as single season, but now with a t index)</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="st">    for (t in 1:nyears) {</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="st">      psi[t] ~ dunif(0,1)</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a><span class="st">      r[t] ~ dunif(0,1)</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a><span class="st">      p2[t] ~ dunif(0,1)</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a><span class="st">      #Multinomial logit link</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a><span class="st">      lp32[t] ~ dnorm(0, 0.001)</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a><span class="st">      lp33[t] ~ dnorm(0, 0.001)</span></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a><span class="st">      p32[t] &lt;- exp(lp32[t]) / (1 + exp(lp32[t]) + exp(lp33[t]))</span></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a><span class="st">      p33[t] &lt;- exp(lp33[t]) / (1 + exp(lp32[t]) + exp(lp33[t]))</span></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a><span class="st">      p31[t] &lt;- 1-p32[t]-p33[t]</span></span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a><span class="st">    # Define initial state vector Omega for each year</span></span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a><span class="st">    for (t in 1:nyears) {</span></span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a><span class="st">      Omega[t,1] &lt;- 1 - psi[t]</span></span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a><span class="st">      Omega[t,2] &lt;- psi[t] * (1-r[t])</span></span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a><span class="st">      Omega[t,3] &lt;- psi[t] * r[t]</span></span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a><span class="st">    # Define observation matrix for each year</span></span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a><span class="st">    # The order of the indices is true state, year, observed state</span></span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true" tabindex="-1"></a><span class="st">    for (t in 1:nyears) {</span></span>
<span id="cb72-28"><a href="#cb72-28" aria-hidden="true" tabindex="-1"></a><span class="st">      Theta[1,t,1] &lt;- 1</span></span>
<span id="cb72-29"><a href="#cb72-29" aria-hidden="true" tabindex="-1"></a><span class="st">      Theta[1,t,2] &lt;- 0</span></span>
<span id="cb72-30"><a href="#cb72-30" aria-hidden="true" tabindex="-1"></a><span class="st">      Theta[1,t,3] &lt;- 0</span></span>
<span id="cb72-31"><a href="#cb72-31" aria-hidden="true" tabindex="-1"></a><span class="st">      Theta[2,t,1] &lt;- 1-p2[t]</span></span>
<span id="cb72-32"><a href="#cb72-32" aria-hidden="true" tabindex="-1"></a><span class="st">      Theta[2,t,2] &lt;- p2[t]</span></span>
<span id="cb72-33"><a href="#cb72-33" aria-hidden="true" tabindex="-1"></a><span class="st">      Theta[2,t,3] &lt;- 0</span></span>
<span id="cb72-34"><a href="#cb72-34" aria-hidden="true" tabindex="-1"></a><span class="st">      Theta[3,t,1] &lt;- p31[t]</span></span>
<span id="cb72-35"><a href="#cb72-35" aria-hidden="true" tabindex="-1"></a><span class="st">      Theta[3,t,2] &lt;- p32[t]</span></span>
<span id="cb72-36"><a href="#cb72-36" aria-hidden="true" tabindex="-1"></a><span class="st">      Theta[3,t,3] &lt;- p33[t]</span></span>
<span id="cb72-37"><a href="#cb72-37" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb72-38"><a href="#cb72-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-39"><a href="#cb72-39" aria-hidden="true" tabindex="-1"></a><span class="st">    # State-space likelihood</span></span>
<span id="cb72-40"><a href="#cb72-40" aria-hidden="true" tabindex="-1"></a><span class="st">    # Define separate parameters of state and observation equation for each year</span></span>
<span id="cb72-41"><a href="#cb72-41" aria-hidden="true" tabindex="-1"></a><span class="st">    for (t in 1:nyears) {</span></span>
<span id="cb72-42"><a href="#cb72-42" aria-hidden="true" tabindex="-1"></a><span class="st">      for (i in 1:nsites) {</span></span>
<span id="cb72-43"><a href="#cb72-43" aria-hidden="true" tabindex="-1"></a><span class="st">      z[i,t] ~ dcat(Omega[t,])  # This is the state equation</span></span>
<span id="cb72-44"><a href="#cb72-44" aria-hidden="true" tabindex="-1"></a><span class="st">        for (j in 1:nsurveys) {</span></span>
<span id="cb72-45"><a href="#cb72-45" aria-hidden="true" tabindex="-1"></a><span class="st">          y[i,j,t] ~ dcat(Theta[z[i,t],t,]) # Observation equation</span></span>
<span id="cb72-46"><a href="#cb72-46" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb72-47"><a href="#cb72-47" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb72-48"><a href="#cb72-48" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb72-49"><a href="#cb72-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-50"><a href="#cb72-50" aria-hidden="true" tabindex="-1"></a><span class="st">    # Derived quantities</span></span>
<span id="cb72-51"><a href="#cb72-51" aria-hidden="true" tabindex="-1"></a><span class="st">    for (t in 1:nyears) {</span></span>
<span id="cb72-52"><a href="#cb72-52" aria-hidden="true" tabindex="-1"></a><span class="st">      for (i in 1:nsites) {</span></span>
<span id="cb72-53"><a href="#cb72-53" aria-hidden="true" tabindex="-1"></a><span class="st">        occ1[i,t] &lt;- equals(z[i,t], 1)</span></span>
<span id="cb72-54"><a href="#cb72-54" aria-hidden="true" tabindex="-1"></a><span class="st">        occ2[i,t] &lt;- equals(z[i,t], 2)</span></span>
<span id="cb72-55"><a href="#cb72-55" aria-hidden="true" tabindex="-1"></a><span class="st">        occ3[i,t] &lt;- equals(z[i,t], 3)</span></span>
<span id="cb72-56"><a href="#cb72-56" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb72-57"><a href="#cb72-57" aria-hidden="true" tabindex="-1"></a><span class="st">      n.occ[t,1] &lt;- sum(occ1[,t])</span></span>
<span id="cb72-58"><a href="#cb72-58" aria-hidden="true" tabindex="-1"></a><span class="st">      n.occ[t,2] &lt;- sum(occ2[,t])</span></span>
<span id="cb72-59"><a href="#cb72-59" aria-hidden="true" tabindex="-1"></a><span class="st">      n.occ[t,3] &lt;- sum(occ3[,t])</span></span>
<span id="cb72-60"><a href="#cb72-60" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb72-61"><a href="#cb72-61" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb72-62"><a href="#cb72-62" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>)</span>
<span id="cb72-63"><a href="#cb72-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-64"><a href="#cb72-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Initial values</span></span>
<span id="cb72-65"><a href="#cb72-65" aria-hidden="true" tabindex="-1"></a>zst <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">3</span>, <span class="at">dim =</span> <span class="fu">c</span>(bdata<span class="sc">$</span>nsites, bdata<span class="sc">$</span>nyears))</span>
<span id="cb72-66"><a href="#cb72-66" aria-hidden="true" tabindex="-1"></a>inits <span class="ot">&lt;-</span> <span class="cf">function</span>() {<span class="fu">list</span>(<span class="at">z =</span> zst)}</span>
<span id="cb72-67"><a href="#cb72-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-68"><a href="#cb72-68" aria-hidden="true" tabindex="-1"></a><span class="co">#Parameters monitored</span></span>
<span id="cb72-69"><a href="#cb72-69" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"psi"</span>, <span class="st">"r"</span>, <span class="st">"p2"</span>, <span class="st">"p31"</span>, <span class="st">"p32"</span>, <span class="st">"p33"</span>, <span class="st">"Omega"</span>, <span class="st">"Theta"</span>, <span class="st">"n.occ"</span>)</span>
<span id="cb72-70"><a href="#cb72-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-71"><a href="#cb72-71" aria-hidden="true" tabindex="-1"></a><span class="co"># MCMC settings</span></span>
<span id="cb72-72"><a href="#cb72-72" aria-hidden="true" tabindex="-1"></a>na <span class="ot">&lt;-</span> <span class="dv">1000</span> ; ni <span class="ot">&lt;-</span> <span class="dv">2000</span> ; nt <span class="ot">&lt;-</span> <span class="dv">2</span> ; nb <span class="ot">&lt;-</span> <span class="dv">1000</span> ; nc <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb72-73"><a href="#cb72-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-74"><a href="#cb72-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Call JAGS</span></span>
<span id="cb72-75"><a href="#cb72-75" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jagsUI)</span>
<span id="cb72-76"><a href="#cb72-76" aria-hidden="true" tabindex="-1"></a>out2 <span class="ot">&lt;-</span> <span class="fu">jags</span>(bdata, inits, params, <span class="st">"../dyn_multistate_occu/static2.txt"</span>, <span class="at">n.adapt =</span> na, <span class="at">n.chains =</span> nc, <span class="at">n.thin =</span> nt, <span class="at">n.iter =</span> ni, <span class="at">n.burnin =</span> nb,</span>
<span id="cb72-77"><a href="#cb72-77" aria-hidden="true" tabindex="-1"></a>             <span class="at">parallel =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Processing function input....... 

Done. 
 
Beginning parallel processing using 3 cores. Console output will be suppressed.

Parallel processing completed.

Calculating statistics....... </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in doTryCatch(return(expr), name, parentenv, handler): At least one Rhat
value could not be calculated.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Done. </code></pre>
</div>
</div>
</section>
<section id="output-figures-1" class="level3">
<h3 class="anchored" data-anchor-id="output-figures-1">Output figures</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">3</span>))</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Because we have many plots, we are just going to plot a few for an example</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="fu">traceplot</span>(out2, <span class="at">parameters =</span> <span class="st">"psi"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="dyn_multistate_occ_overview_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="output-parameters" class="level3">
<h3 class="anchored" data-anchor-id="output-parameters">Output parameters</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(out2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>JAGS output for model '../dyn_multistate_occu/static2.txt', generated by jagsUI.
Estimates based on 3 chains of 2000 iterations,
adaptation = 1000 iterations (sufficient),
burn-in = 1000 iterations and thin rate = 2,
yielding 1500 total samples from the joint posterior. 
MCMC ran in parallel for 0.278 minutes at time 2022-09-14 15:58:32.

                mean     sd    2.5%     50%   97.5% overlap0 f  Rhat n.eff
psi[1]         0.477  0.081   0.320   0.474   0.643    FALSE 1 1.001  1191
psi[2]         0.385  0.082   0.233   0.380   0.563    FALSE 1 1.008   290
psi[3]         0.219  0.064   0.112   0.214   0.357    FALSE 1 1.007  1060
psi[4]         0.433  0.082   0.276   0.430   0.601    FALSE 1 1.002  1089
psi[5]         0.345  0.087   0.195   0.339   0.542    FALSE 1 1.006   486
psi[6]         0.292  0.077   0.159   0.287   0.459    FALSE 1 1.004  1045
psi[7]         0.381  0.097   0.223   0.371   0.604    FALSE 1 1.005   676
psi[8]         0.420  0.078   0.281   0.417   0.573    FALSE 1 1.001  1500
r[1]           0.237  0.091   0.084   0.228   0.441    FALSE 1 1.000  1500
r[2]           0.409  0.118   0.189   0.404   0.648    FALSE 1 1.002  1390
r[3]           0.594  0.148   0.300   0.601   0.856    FALSE 1 1.001  1173
r[4]           0.263  0.093   0.102   0.256   0.465    FALSE 1 1.000  1500
r[5]           0.395  0.128   0.172   0.388   0.662    FALSE 1 1.001  1500
r[6]           0.312  0.129   0.100   0.298   0.589    FALSE 1 1.000  1500
r[7]           0.482  0.135   0.248   0.475   0.744    FALSE 1 1.000  1500
r[8]           0.384  0.111   0.183   0.379   0.608    FALSE 1 1.000  1500
p2[1]          0.500  0.074   0.353   0.503   0.640    FALSE 1 0.999  1500
p2[2]          0.453  0.096   0.258   0.456   0.636    FALSE 1 1.006   379
p2[3]          0.700  0.124   0.438   0.710   0.905    FALSE 1 1.003   834
p2[4]          0.482  0.077   0.334   0.482   0.631    FALSE 1 1.002   964
p2[5]          0.407  0.106   0.207   0.405   0.619    FALSE 1 1.002  1500
p2[6]          0.408  0.102   0.216   0.406   0.616    FALSE 1 1.000  1500
p2[7]          0.335  0.112   0.142   0.331   0.563    FALSE 1 1.000  1500
p2[8]          0.542  0.084   0.374   0.543   0.696    FALSE 1 1.002   715
p31[1]         0.002  0.013   0.000   0.000   0.012     TRUE 1 1.289   102
p31[2]         0.000  0.001   0.000   0.000   0.001     TRUE 1 1.164   178
p31[3]         0.003  0.013   0.000   0.000   0.033     TRUE 1 1.192    57
p31[4]         0.002  0.013   0.000   0.000   0.027    FALSE 1 1.132   108
p31[5]         0.003  0.013   0.000   0.000   0.038    FALSE 1 1.096    92
p31[6]         0.007  0.021   0.000   0.000   0.068    FALSE 1 1.208    35
p31[7]         0.001  0.004   0.000   0.000   0.007    FALSE 1 1.218   109
p31[8]         0.000  0.003   0.000   0.000   0.005    FALSE 1 1.153   112
p32[1]         0.193  0.101   0.044   0.178   0.426    FALSE 1 1.002  1500
p32[2]         0.210  0.081   0.074   0.202   0.393    FALSE 1 1.003   599
p32[3]         0.153  0.080   0.034   0.143   0.335    FALSE 1 1.001  1498
p32[4]         0.371  0.119   0.166   0.365   0.614    FALSE 1 1.000  1500
p32[5]         0.150  0.079   0.032   0.139   0.342    FALSE 1 1.001  1500
p32[6]         0.329  0.130   0.114   0.318   0.606    FALSE 1 0.999  1500
p32[7]         0.141  0.063   0.043   0.133   0.279    FALSE 1 1.000  1500
p32[8]         0.167  0.074   0.055   0.157   0.330    FALSE 1 1.003  1498
p33[1]         0.805  0.102   0.563   0.821   0.955    FALSE 1 1.004  1060
p33[2]         0.790  0.081   0.607   0.798   0.926    FALSE 1 1.003   587
p33[3]         0.844  0.081   0.662   0.854   0.965    FALSE 1 1.000  1500
p33[4]         0.627  0.119   0.384   0.631   0.834    FALSE 1 1.001  1220
p33[5]         0.847  0.080   0.653   0.859   0.967    FALSE 1 1.002  1500
p33[6]         0.664  0.130   0.389   0.675   0.879    FALSE 1 1.000  1500
p33[7]         0.858  0.063   0.720   0.865   0.957    FALSE 1 1.001  1500
p33[8]         0.833  0.074   0.670   0.843   0.945    FALSE 1 1.003  1400
Omega[1,1]     0.523  0.081   0.357   0.526   0.680    FALSE 1 1.001  1191
Omega[2,1]     0.615  0.082   0.437   0.620   0.767    FALSE 1 1.008   290
Omega[3,1]     0.781  0.064   0.643   0.786   0.888    FALSE 1 1.007  1060
Omega[4,1]     0.567  0.082   0.399   0.570   0.724    FALSE 1 1.002  1089
Omega[5,1]     0.655  0.087   0.458   0.661   0.805    FALSE 1 1.006   486
Omega[6,1]     0.708  0.077   0.541   0.713   0.841    FALSE 1 1.004  1045
Omega[7,1]     0.619  0.097   0.396   0.629   0.777    FALSE 1 1.005   676
Omega[8,1]     0.580  0.078   0.427   0.583   0.719    FALSE 1 1.001  1500
Omega[1,2]     0.364  0.078   0.220   0.357   0.526    FALSE 1 1.001  1500
Omega[2,2]     0.229  0.072   0.108   0.221   0.381    FALSE 1 1.011   333
Omega[3,2]     0.089  0.044   0.026   0.083   0.193    FALSE 1 1.000  1500
Omega[4,2]     0.319  0.074   0.187   0.316   0.473    FALSE 1 1.001  1089
Omega[5,2]     0.210  0.077   0.089   0.203   0.389    FALSE 1 1.003  1500
Omega[6,2]     0.202  0.069   0.089   0.194   0.363    FALSE 1 1.008   886
Omega[7,2]     0.202  0.087   0.078   0.188   0.413    FALSE 1 1.005   649
Omega[8,2]     0.259  0.069   0.141   0.253   0.409    FALSE 1 1.000  1500
Omega[1,3]     0.112  0.046   0.038   0.107   0.215    FALSE 1 1.000  1500
Omega[2,3]     0.156  0.053   0.067   0.151   0.272    FALSE 1 1.000  1500
Omega[3,3]     0.130  0.050   0.050   0.124   0.242    FALSE 1 1.004   655
Omega[4,3]     0.114  0.046   0.044   0.107   0.216    FALSE 1 1.000  1500
Omega[5,3]     0.134  0.051   0.051   0.128   0.252    FALSE 1 1.005   503
Omega[6,3]     0.090  0.043   0.025   0.083   0.188    FALSE 1 1.000  1500
Omega[7,3]     0.180  0.057   0.087   0.174   0.312    FALSE 1 0.999  1500
Omega[8,3]     0.161  0.055   0.069   0.155   0.278    FALSE 1 1.002  1500
Theta[1,1,1]   1.000  0.000   1.000   1.000   1.000    FALSE 1    NA     1
Theta[2,1,1]   0.500  0.074   0.360   0.497   0.647    FALSE 1 0.999  1500
Theta[3,1,1]   0.002  0.013   0.000   0.000   0.012     TRUE 1 1.289   102
Theta[1,2,1]   1.000  0.000   1.000   1.000   1.000    FALSE 1    NA     1
Theta[2,2,1]   0.547  0.096   0.364   0.544   0.742    FALSE 1 1.006   379
Theta[3,2,1]   0.000  0.001   0.000   0.000   0.001     TRUE 1 1.164   178
Theta[1,3,1]   1.000  0.000   1.000   1.000   1.000    FALSE 1    NA     1
Theta[2,3,1]   0.300  0.124   0.095   0.290   0.562    FALSE 1 1.003   834
Theta[3,3,1]   0.003  0.013   0.000   0.000   0.033     TRUE 1 1.192    57
Theta[1,4,1]   1.000  0.000   1.000   1.000   1.000    FALSE 1    NA     1
Theta[2,4,1]   0.518  0.077   0.369   0.518   0.666    FALSE 1 1.002   964
Theta[3,4,1]   0.002  0.013   0.000   0.000   0.027    FALSE 1 1.132   108
Theta[1,5,1]   1.000  0.000   1.000   1.000   1.000    FALSE 1    NA     1
Theta[2,5,1]   0.593  0.106   0.381   0.595   0.793    FALSE 1 1.002  1500
Theta[3,5,1]   0.003  0.013   0.000   0.000   0.038    FALSE 1 1.096    92
Theta[1,6,1]   1.000  0.000   1.000   1.000   1.000    FALSE 1    NA     1
Theta[2,6,1]   0.592  0.102   0.384   0.594   0.784    FALSE 1 1.000  1500
Theta[3,6,1]   0.007  0.021   0.000   0.000   0.068    FALSE 1 1.208    35
Theta[1,7,1]   1.000  0.000   1.000   1.000   1.000    FALSE 1    NA     1
Theta[2,7,1]   0.665  0.112   0.437   0.669   0.858    FALSE 1 1.000  1500
Theta[3,7,1]   0.001  0.004   0.000   0.000   0.007    FALSE 1 1.218   109
Theta[1,8,1]   1.000  0.000   1.000   1.000   1.000    FALSE 1    NA     1
Theta[2,8,1]   0.458  0.084   0.304   0.457   0.626    FALSE 1 1.002   715
Theta[3,8,1]   0.000  0.003   0.000   0.000   0.005    FALSE 1 1.153   112
Theta[1,1,2]   0.000  0.000   0.000   0.000   0.000    FALSE 1    NA     1
Theta[2,1,2]   0.500  0.074   0.353   0.503   0.640    FALSE 1 0.999  1500
Theta[3,1,2]   0.193  0.101   0.044   0.178   0.426    FALSE 1 1.002  1500
Theta[1,2,2]   0.000  0.000   0.000   0.000   0.000    FALSE 1    NA     1
Theta[2,2,2]   0.453  0.096   0.258   0.456   0.636    FALSE 1 1.006   379
Theta[3,2,2]   0.210  0.081   0.074   0.202   0.393    FALSE 1 1.003   599
Theta[1,3,2]   0.000  0.000   0.000   0.000   0.000    FALSE 1    NA     1
Theta[2,3,2]   0.700  0.124   0.438   0.710   0.905    FALSE 1 1.003   834
Theta[3,3,2]   0.153  0.080   0.034   0.143   0.335    FALSE 1 1.001  1498
Theta[1,4,2]   0.000  0.000   0.000   0.000   0.000    FALSE 1    NA     1
Theta[2,4,2]   0.482  0.077   0.334   0.482   0.631    FALSE 1 1.002   964
Theta[3,4,2]   0.371  0.119   0.166   0.365   0.614    FALSE 1 1.000  1500
Theta[1,5,2]   0.000  0.000   0.000   0.000   0.000    FALSE 1    NA     1
Theta[2,5,2]   0.407  0.106   0.207   0.405   0.619    FALSE 1 1.002  1500
Theta[3,5,2]   0.150  0.079   0.032   0.139   0.342    FALSE 1 1.001  1500
Theta[1,6,2]   0.000  0.000   0.000   0.000   0.000    FALSE 1    NA     1
Theta[2,6,2]   0.408  0.102   0.216   0.406   0.616    FALSE 1 1.000  1500
Theta[3,6,2]   0.329  0.130   0.114   0.318   0.606    FALSE 1 0.999  1500
Theta[1,7,2]   0.000  0.000   0.000   0.000   0.000    FALSE 1    NA     1
Theta[2,7,2]   0.335  0.112   0.142   0.331   0.563    FALSE 1 1.000  1500
Theta[3,7,2]   0.141  0.063   0.043   0.133   0.279    FALSE 1 1.000  1500
Theta[1,8,2]   0.000  0.000   0.000   0.000   0.000    FALSE 1    NA     1
Theta[2,8,2]   0.542  0.084   0.374   0.543   0.696    FALSE 1 1.002   715
Theta[3,8,2]   0.167  0.074   0.055   0.157   0.330    FALSE 1 1.003  1498
Theta[1,1,3]   0.000  0.000   0.000   0.000   0.000    FALSE 1    NA     1
Theta[2,1,3]   0.000  0.000   0.000   0.000   0.000    FALSE 1    NA     1
Theta[3,1,3]   0.805  0.102   0.563   0.821   0.955    FALSE 1 1.004  1060
Theta[1,2,3]   0.000  0.000   0.000   0.000   0.000    FALSE 1    NA     1
Theta[2,2,3]   0.000  0.000   0.000   0.000   0.000    FALSE 1    NA     1
Theta[3,2,3]   0.790  0.081   0.607   0.798   0.926    FALSE 1 1.003   587
Theta[1,3,3]   0.000  0.000   0.000   0.000   0.000    FALSE 1    NA     1
Theta[2,3,3]   0.000  0.000   0.000   0.000   0.000    FALSE 1    NA     1
Theta[3,3,3]   0.844  0.081   0.662   0.854   0.965    FALSE 1 1.000  1500
Theta[1,4,3]   0.000  0.000   0.000   0.000   0.000    FALSE 1    NA     1
Theta[2,4,3]   0.000  0.000   0.000   0.000   0.000    FALSE 1    NA     1
Theta[3,4,3]   0.627  0.119   0.384   0.631   0.834    FALSE 1 1.001  1220
Theta[1,5,3]   0.000  0.000   0.000   0.000   0.000    FALSE 1    NA     1
Theta[2,5,3]   0.000  0.000   0.000   0.000   0.000    FALSE 1    NA     1
Theta[3,5,3]   0.847  0.080   0.653   0.859   0.967    FALSE 1 1.002  1500
Theta[1,6,3]   0.000  0.000   0.000   0.000   0.000    FALSE 1    NA     1
Theta[2,6,3]   0.000  0.000   0.000   0.000   0.000    FALSE 1    NA     1
Theta[3,6,3]   0.664  0.130   0.389   0.675   0.879    FALSE 1 1.000  1500
Theta[1,7,3]   0.000  0.000   0.000   0.000   0.000    FALSE 1    NA     1
Theta[2,7,3]   0.000  0.000   0.000   0.000   0.000    FALSE 1    NA     1
Theta[3,7,3]   0.858  0.063   0.720   0.865   0.957    FALSE 1 1.001  1500
Theta[1,8,3]   0.000  0.000   0.000   0.000   0.000    FALSE 1    NA     1
Theta[2,8,3]   0.000  0.000   0.000   0.000   0.000    FALSE 1    NA     1
Theta[3,8,3]   0.833  0.074   0.670   0.843   0.945    FALSE 1 1.003  1400
n.occ[1,1]    20.886  1.259  18.000  21.000  22.000    FALSE 1 1.002  1500
n.occ[2,1]    24.876  1.528  21.000  25.000  26.000    FALSE 1 1.027   333
n.occ[3,1]    31.935  0.264  31.000  32.000  32.000    FALSE 1 1.020   523
n.occ[4,1]    22.875  1.315  20.000  23.000  24.000    FALSE 1 1.000  1500
n.occ[5,1]    26.555  1.869  22.000  27.000  28.000    FALSE 1 1.000  1500
n.occ[6,1]    28.704  1.683  24.000  29.000  30.000    FALSE 1 1.009   557
n.occ[7,1]    24.836  2.631  17.000  26.000  27.000    FALSE 1 1.006  1147
n.occ[8,1]    23.391  0.993  21.000  24.000  24.000    FALSE 1 1.005  1500
n.occ[1,2]    15.054  1.267  14.000  15.000  18.000    FALSE 1 1.002  1500
n.occ[2,2]     9.124  1.528   8.000   9.000  13.000    FALSE 1 1.027   333
n.occ[3,2]     3.043  0.306   3.000   3.000   4.000    FALSE 1 1.009   425
n.occ[4,2]    13.122  1.315  12.000  13.000  16.000    FALSE 1 1.000  1500
n.occ[5,2]     8.443  1.869   7.000   8.000  13.000    FALSE 1 1.000  1500
n.occ[6,2]     8.282  1.668   7.000   8.000  13.000    FALSE 1 1.010   570
n.occ[7,2]     8.164  2.631   6.000   7.000  16.000    FALSE 1 1.006  1147
n.occ[8,2]    10.585  1.009  10.000  10.000  13.000    FALSE 1 1.005  1500
n.occ[1,3]     4.060  0.259   4.000   4.000   5.000    FALSE 1 1.016  1500
n.occ[2,3]     6.000  0.000   6.000   6.000   6.000    FALSE 1    NA     1
n.occ[3,3]     5.021  0.149   5.000   5.000   5.000    FALSE 1 1.020  1500
n.occ[4,3]     4.003  0.052   4.000   4.000   4.000    FALSE 1 1.105  1497
n.occ[5,3]     5.003  0.063   5.000   5.000   5.000    FALSE 1 1.105  1500
n.occ[6,3]     3.014  0.133   3.000   3.000   3.000    FALSE 1 1.089   432
n.occ[7,3]     7.000  0.000   7.000   7.000   7.000    FALSE 1    NA     1
n.occ[8,3]     6.024  0.153   6.000   6.000   6.000    FALSE 1 1.003  1500
deviance     576.353 17.533 544.380 575.636 612.988    FALSE 1 1.001  1500

**WARNING** Rhat values indicate convergence failure. 
Rhat is the potential scale reduction factor (at convergence, Rhat=1). 
For each parameter, n.eff is a crude measure of effective sample size. 

overlap0 checks if 0 falls in the parameter's 95% credible interval.
f is the proportion of the posterior with the same sign as the mean;
i.e., our confidence that the parameter is positive or negative.

DIC info: (pD = var(deviance)/2) 
pD = 153.7 and DIC = 730.078 
DIC is an estimate of expected predictive error (lower is better).</code></pre>
</div>
</div>
</section>
</section>
<section id="dynamic-multi-season-model" class="level2">
<h2 class="anchored" data-anchor-id="dynamic-multi-season-model">Dynamic Multi-season Model</h2>
<section id="model-descritiption" class="level3">
<h3 class="anchored" data-anchor-id="model-descritiption">Model descritiption</h3>
<p>This model is again in the simplest form, where parameters have no dependency on site, survey, season, or covariates. The difference between this one and the previous one is the transition matrix and how each of the following years depends on the previous one. Additionally, here it uses a Dirichlet distribution as the prior for the vector <span class="math inline">\(p3[1:3]\)</span> in the observation matrix for the constraints on the probabilities. This model essentially incorporates all the aspects of the simulation we did earlier, where we start at year 1 with an initial state, and given a matrix of transition probabilities, the state of future years depends on the state of the year before.</p>
<p>Year 1:</p>
<p><span class="math display">\[
z_{i,1}\sim Categorical(\Omega), \text{with} \quad \Omega = [1-\psi \quad \psi(1-r) \quad \psi r]
\]</span></p>
<p>Years 2 and beyond, where phi is the matrix of transition probabilities:</p>
<p><span class="math display">\[
z_{i,t}|z_{i,t-1} \sim Categorical(\Phi_{z{(t-1)}, z{(t)}})
\]</span></p>
<p>And observations given by:</p>
<p><span class="math display">\[
y_{i,j,t}|z_{i,t} \sim Categorical(\Theta_{z,o})
\]</span></p>
</section>
<section id="model" class="level3">
<h3 class="anchored" data-anchor-id="model">Model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Same as in the static multi-season case</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(bdata <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">y =</span> y, <span class="at">nsites =</span> <span class="fu">dim</span>(y)[<span class="dv">1</span>], <span class="at">nsurveys =</span> <span class="fu">dim</span>(y)[<span class="dv">2</span>], <span class="at">nyears =</span> <span class="fu">dim</span>(y)[<span class="dv">3</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 4
 $ y       : int [1:40, 1:4, 1:8] 1 1 1 3 1 1 1 1 2 2 ...
 $ nsites  : int 40
 $ nsurveys: int 4
 $ nyears  : int 8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We specify the model</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="at">file =</span> <span class="st">'../dyn_multistate_occu/dynamic1.txt'</span>,<span class="st">"</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="st">    model {</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="st">      #Priors</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="st">      psi ~ dunif(0,1)</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a><span class="st">      r ~ dunif(0,1)</span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a><span class="st">      for (s in 1:3) {</span></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a><span class="st">        phi[s] ~ dunif(0,1)</span></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a><span class="st">        rho[s] ~ dunif(0,1)</span></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a><span class="st">      p2 ~ dunif(0,1)</span></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a><span class="st">      for (s in 1:3) {</span></span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a><span class="st">        beta[s] ~ dgamma(1, 1)</span></span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a><span class="st">        p3[s] &lt;- beta[s] / sum(beta[])</span></span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a><span class="st">      # Define initia state vector</span></span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a><span class="st">      Omega[1] &lt;- 1 - psi</span></span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a><span class="st">      Omega[2] &lt;- psi * (1-r)</span></span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a><span class="st">      Omega[3] &lt;- psi * r</span></span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a><span class="st">      # Define transition matrix</span></span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a><span class="st">      PhiMat[1,1] &lt;- 1 - phi[1]</span></span>
<span id="cb81-29"><a href="#cb81-29" aria-hidden="true" tabindex="-1"></a><span class="st">      PhiMat[1,2] &lt;- phi[1] * (1 - rho[1])</span></span>
<span id="cb81-30"><a href="#cb81-30" aria-hidden="true" tabindex="-1"></a><span class="st">      PhiMat[1,3] &lt;- phi[1] * rho[1]</span></span>
<span id="cb81-31"><a href="#cb81-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-32"><a href="#cb81-32" aria-hidden="true" tabindex="-1"></a><span class="st">      PhiMat[2,1] &lt;- 1 - phi[2]</span></span>
<span id="cb81-33"><a href="#cb81-33" aria-hidden="true" tabindex="-1"></a><span class="st">      PhiMat[2,2] &lt;- phi[2] * (1 - rho[2])</span></span>
<span id="cb81-34"><a href="#cb81-34" aria-hidden="true" tabindex="-1"></a><span class="st">      PhiMat[2,3] &lt;- phi[2] * rho[2]</span></span>
<span id="cb81-35"><a href="#cb81-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-36"><a href="#cb81-36" aria-hidden="true" tabindex="-1"></a><span class="st">      PhiMat[3,1] &lt;- 1 - phi[3]</span></span>
<span id="cb81-37"><a href="#cb81-37" aria-hidden="true" tabindex="-1"></a><span class="st">      PhiMat[3,2] &lt;- phi[3] * (1 - rho[3])</span></span>
<span id="cb81-38"><a href="#cb81-38" aria-hidden="true" tabindex="-1"></a><span class="st">      PhiMat[3,3] &lt;- phi[3] * rho[3]</span></span>
<span id="cb81-39"><a href="#cb81-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-40"><a href="#cb81-40" aria-hidden="true" tabindex="-1"></a><span class="st">      # Define observation matrix</span></span>
<span id="cb81-41"><a href="#cb81-41" aria-hidden="true" tabindex="-1"></a><span class="st">      Theta[1,1] &lt;- 1</span></span>
<span id="cb81-42"><a href="#cb81-42" aria-hidden="true" tabindex="-1"></a><span class="st">      Theta[1,2] &lt;- 0</span></span>
<span id="cb81-43"><a href="#cb81-43" aria-hidden="true" tabindex="-1"></a><span class="st">      Theta[1,3] &lt;- 0</span></span>
<span id="cb81-44"><a href="#cb81-44" aria-hidden="true" tabindex="-1"></a><span class="st">      Theta[2,1] &lt;- 1-p2</span></span>
<span id="cb81-45"><a href="#cb81-45" aria-hidden="true" tabindex="-1"></a><span class="st">      Theta[2,2] &lt;- p2</span></span>
<span id="cb81-46"><a href="#cb81-46" aria-hidden="true" tabindex="-1"></a><span class="st">      Theta[2,3] &lt;- 0</span></span>
<span id="cb81-47"><a href="#cb81-47" aria-hidden="true" tabindex="-1"></a><span class="st">      Theta[3,1] &lt;- p3[1]</span></span>
<span id="cb81-48"><a href="#cb81-48" aria-hidden="true" tabindex="-1"></a><span class="st">      Theta[3,2] &lt;- p3[2]</span></span>
<span id="cb81-49"><a href="#cb81-49" aria-hidden="true" tabindex="-1"></a><span class="st">      Theta[3,3] &lt;- p3[3]</span></span>
<span id="cb81-50"><a href="#cb81-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-51"><a href="#cb81-51" aria-hidden="true" tabindex="-1"></a><span class="st">      # State-space likelihood</span></span>
<span id="cb81-52"><a href="#cb81-52" aria-hidden="true" tabindex="-1"></a><span class="st">      for (i in 1:nsites) {</span></span>
<span id="cb81-53"><a href="#cb81-53" aria-hidden="true" tabindex="-1"></a><span class="st">        z[i,1] ~ dcat(Omega[])</span></span>
<span id="cb81-54"><a href="#cb81-54" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb81-55"><a href="#cb81-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-56"><a href="#cb81-56" aria-hidden="true" tabindex="-1"></a><span class="st">      for (i in 1:nsites) {</span></span>
<span id="cb81-57"><a href="#cb81-57" aria-hidden="true" tabindex="-1"></a><span class="st">        for (t in 1:(nyears-1)) {</span></span>
<span id="cb81-58"><a href="#cb81-58" aria-hidden="true" tabindex="-1"></a><span class="st">          z[i,t+1] ~ dcat(PhiMat[z[i,t],])</span></span>
<span id="cb81-59"><a href="#cb81-59" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb81-60"><a href="#cb81-60" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb81-61"><a href="#cb81-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-62"><a href="#cb81-62" aria-hidden="true" tabindex="-1"></a><span class="st">      for (t in 1:nyears) {</span></span>
<span id="cb81-63"><a href="#cb81-63" aria-hidden="true" tabindex="-1"></a><span class="st">        for (i in 1:nsites) {</span></span>
<span id="cb81-64"><a href="#cb81-64" aria-hidden="true" tabindex="-1"></a><span class="st">          for (j in 1:nsurveys) {</span></span>
<span id="cb81-65"><a href="#cb81-65" aria-hidden="true" tabindex="-1"></a><span class="st">            y[i,j,t] ~ dcat(Theta[z[i,t],])</span></span>
<span id="cb81-66"><a href="#cb81-66" aria-hidden="true" tabindex="-1"></a><span class="st">          }</span></span>
<span id="cb81-67"><a href="#cb81-67" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb81-68"><a href="#cb81-68" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb81-69"><a href="#cb81-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-70"><a href="#cb81-70" aria-hidden="true" tabindex="-1"></a><span class="st">      # Derived quantities</span></span>
<span id="cb81-71"><a href="#cb81-71" aria-hidden="true" tabindex="-1"></a><span class="st">      for (t in 1:nyears) {</span></span>
<span id="cb81-72"><a href="#cb81-72" aria-hidden="true" tabindex="-1"></a><span class="st">        for (i in 1:nsites) {</span></span>
<span id="cb81-73"><a href="#cb81-73" aria-hidden="true" tabindex="-1"></a><span class="st">          occ1[i,t] &lt;- equals(z[i,t], 1)</span></span>
<span id="cb81-74"><a href="#cb81-74" aria-hidden="true" tabindex="-1"></a><span class="st">          occ2[i,t] &lt;- equals(z[i,t], 2)</span></span>
<span id="cb81-75"><a href="#cb81-75" aria-hidden="true" tabindex="-1"></a><span class="st">          occ3[i,t] &lt;- equals(z[i,t], 3)</span></span>
<span id="cb81-76"><a href="#cb81-76" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb81-77"><a href="#cb81-77" aria-hidden="true" tabindex="-1"></a><span class="st">        n.occ[t,1] &lt;- sum(occ1[,t])</span></span>
<span id="cb81-78"><a href="#cb81-78" aria-hidden="true" tabindex="-1"></a><span class="st">        n.occ[t,2] &lt;- sum(occ2[,t])</span></span>
<span id="cb81-79"><a href="#cb81-79" aria-hidden="true" tabindex="-1"></a><span class="st">        n.occ[t,3] &lt;- sum(occ3[,t])</span></span>
<span id="cb81-80"><a href="#cb81-80" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb81-81"><a href="#cb81-81" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb81-82"><a href="#cb81-82" aria-hidden="true" tabindex="-1"></a><span class="st">    "</span>)</span>
<span id="cb81-83"><a href="#cb81-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-84"><a href="#cb81-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-85"><a href="#cb81-85" aria-hidden="true" tabindex="-1"></a><span class="co"># Initial values</span></span>
<span id="cb81-86"><a href="#cb81-86" aria-hidden="true" tabindex="-1"></a>inits <span class="ot">&lt;-</span> <span class="cf">function</span>() {<span class="fu">list</span>(<span class="at">z =</span> <span class="fu">array</span>(<span class="dv">3</span>, <span class="at">dim =</span> <span class="fu">c</span>(bdata<span class="sc">$</span>nsites, bdata<span class="sc">$</span>nyears)))}</span>
<span id="cb81-87"><a href="#cb81-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-88"><a href="#cb81-88" aria-hidden="true" tabindex="-1"></a><span class="co">#Parameters monitored</span></span>
<span id="cb81-89"><a href="#cb81-89" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"psi"</span>, <span class="st">"r"</span>, <span class="st">"phi"</span>, <span class="st">"rho"</span>, <span class="st">"p2"</span>, <span class="st">"p3"</span>, <span class="st">"Omega"</span>, <span class="st">"PhiMat"</span>, <span class="st">"Theta"</span>, <span class="st">"n.occ"</span>, <span class="st">"z"</span>)</span>
<span id="cb81-90"><a href="#cb81-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-91"><a href="#cb81-91" aria-hidden="true" tabindex="-1"></a><span class="co"># MCMC settings</span></span>
<span id="cb81-92"><a href="#cb81-92" aria-hidden="true" tabindex="-1"></a>na <span class="ot">&lt;-</span> <span class="dv">1000</span> ; ni <span class="ot">&lt;-</span> <span class="dv">2000</span> ; nt <span class="ot">&lt;-</span> <span class="dv">2</span> ; nb <span class="ot">&lt;-</span> <span class="dv">1000</span> ; nc <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb81-93"><a href="#cb81-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-94"><a href="#cb81-94" aria-hidden="true" tabindex="-1"></a><span class="co"># Call JAGS</span></span>
<span id="cb81-95"><a href="#cb81-95" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jagsUI)</span>
<span id="cb81-96"><a href="#cb81-96" aria-hidden="true" tabindex="-1"></a>out3 <span class="ot">&lt;-</span> <span class="fu">jags</span>(bdata, inits, params, <span class="st">"../dyn_multistate_occu/dynamic1.txt"</span>, <span class="at">n.adapt =</span> na, <span class="at">n.chains =</span> nc, <span class="at">n.thin =</span> nt, <span class="at">n.iter =</span> ni, <span class="at">n.burnin =</span> nb,</span>
<span id="cb81-97"><a href="#cb81-97" aria-hidden="true" tabindex="-1"></a>             <span class="at">parallel =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Processing function input....... 

Done. 
 
Beginning parallel processing using 3 cores. Console output will be suppressed.

Parallel processing completed.

Calculating statistics....... </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in doTryCatch(return(expr), name, parentenv, handler): At least one Rhat
value could not be calculated.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Done. </code></pre>
</div>
</div>
</section>
<section id="output-figures-2" class="level3">
<h3 class="anchored" data-anchor-id="output-figures-2">Output figures</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">3</span>))</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Because we have many plots, we are just going to plot a few for an example</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="fu">traceplot</span>(out3, <span class="at">parameters =</span> <span class="st">"PhiMat"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="dyn_multistate_occ_overview_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="params" class="level3">
<h3 class="anchored" data-anchor-id="params">Params</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(out3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>JAGS output for model '../dyn_multistate_occu/dynamic1.txt', generated by jagsUI.
Estimates based on 3 chains of 2000 iterations,
adaptation = 1000 iterations (sufficient),
burn-in = 1000 iterations and thin rate = 2,
yielding 1500 total samples from the joint posterior. 
MCMC ran in parallel for 0.466 minutes at time 2022-09-14 15:58:49.

               mean     sd    2.5%     50%   97.5% overlap0 f  Rhat n.eff
psi           0.478  0.081   0.326   0.479   0.637    FALSE 1 1.000  1500
r             0.232  0.090   0.082   0.225   0.433    FALSE 1 1.000  1500
phi[1]        0.193  0.031   0.136   0.192   0.257    FALSE 1 1.004   418
phi[2]        0.424  0.068   0.297   0.422   0.566    FALSE 1 1.003   673
phi[3]        0.922  0.046   0.819   0.928   0.988    FALSE 1 1.002  1500
rho[1]        0.048  0.037   0.002   0.039   0.147    FALSE 1 1.000  1500
rho[2]        0.295  0.090   0.139   0.288   0.479    FALSE 1 1.003   669
rho[3]        0.847  0.062   0.708   0.854   0.946    FALSE 1 1.000  1500
p2            0.482  0.034   0.417   0.482   0.549    FALSE 1 1.000  1500
p3[1]         0.006  0.006   0.000   0.004   0.022    FALSE 1 1.003   681
p3[2]         0.205  0.031   0.149   0.203   0.267    FALSE 1 1.002  1500
p3[3]         0.789  0.031   0.724   0.792   0.847    FALSE 1 1.002  1489
Omega[1]      0.522  0.081   0.363   0.521   0.674    FALSE 1 1.000  1500
Omega[2]      0.368  0.078   0.226   0.365   0.521    FALSE 1 0.999  1500
Omega[3]      0.111  0.046   0.038   0.105   0.214    FALSE 1 1.001  1500
PhiMat[1,1]   0.807  0.031   0.743   0.808   0.864    FALSE 1 1.004   418
PhiMat[2,1]   0.576  0.068   0.434   0.578   0.703    FALSE 1 1.003   673
PhiMat[3,1]   0.078  0.046   0.012   0.072   0.181    FALSE 1 1.002  1500
PhiMat[1,2]   0.184  0.031   0.126   0.184   0.246    FALSE 1 1.004   422
PhiMat[2,2]   0.299  0.063   0.188   0.293   0.426    FALSE 1 1.003   545
PhiMat[3,2]   0.141  0.057   0.049   0.134   0.268    FALSE 1 1.000  1500
PhiMat[1,3]   0.009  0.007   0.000   0.007   0.027    FALSE 1 0.999  1500
PhiMat[2,3]   0.125  0.042   0.054   0.120   0.219    FALSE 1 1.002   791
PhiMat[3,3]   0.780  0.068   0.634   0.785   0.897    FALSE 1 1.000  1500
Theta[1,1]    1.000  0.000   1.000   1.000   1.000    FALSE 1    NA     1
Theta[2,1]    0.518  0.034   0.451   0.518   0.583    FALSE 1 1.000  1500
Theta[3,1]    0.006  0.006   0.000   0.004   0.022    FALSE 1 1.003   681
Theta[1,2]    0.000  0.000   0.000   0.000   0.000    FALSE 1    NA     1
Theta[2,2]    0.482  0.034   0.417   0.482   0.549    FALSE 1 1.000  1500
Theta[3,2]    0.205  0.031   0.149   0.203   0.267    FALSE 1 1.002  1500
Theta[1,3]    0.000  0.000   0.000   0.000   0.000    FALSE 1    NA     1
Theta[2,3]    0.000  0.000   0.000   0.000   0.000    FALSE 1    NA     1
Theta[3,3]    0.789  0.031   0.724   0.792   0.847    FALSE 1 1.002  1489
n.occ[1,1]   20.991  1.051  18.000  21.000  22.000    FALSE 1 1.002  1500
n.occ[2,1]   25.506  0.717  24.000  26.000  26.000    FALSE 1 1.001  1500
n.occ[3,1]   31.289  0.854  29.000  31.000  32.000    FALSE 1 1.001  1500
n.occ[4,1]   23.193  0.846  21.000  23.000  24.000    FALSE 1 1.001  1500
n.occ[5,1]   27.425  0.785  26.000  28.000  28.000    FALSE 1 1.000  1500
n.occ[6,1]   29.376  0.809  27.000  30.000  30.000    FALSE 1 1.001  1500
n.occ[7,1]   26.557  0.666  25.000  27.000  27.000    FALSE 1 1.002  1349
n.occ[8,1]   23.514  0.729  22.000  24.000  24.000    FALSE 1 1.001  1429
n.occ[1,2]   15.004  1.054  14.000  15.000  18.000    FALSE 1 1.002  1500
n.occ[2,2]    8.489  0.720   8.000   8.000  10.000    FALSE 1 1.002  1500
n.occ[3,2]    3.675  0.865   3.000   3.000   6.000    FALSE 1 1.001  1500
n.occ[4,2]   12.807  0.846  12.000  13.000  15.000    FALSE 1 1.001  1500
n.occ[5,2]    7.575  0.785   7.000   7.000   9.000    FALSE 1 1.000  1500
n.occ[6,2]    7.623  0.809   7.000   7.000  10.000    FALSE 1 1.001  1500
n.occ[7,2]    6.443  0.666   6.000   6.000   8.000    FALSE 1 1.002  1349
n.occ[8,2]   10.484  0.730  10.000  10.000  12.000    FALSE 1 1.002  1277
n.occ[1,3]    4.005  0.068   4.000   4.000   4.000    FALSE 1 1.111   805
n.occ[2,3]    6.005  0.073   6.000   6.000   6.000    FALSE 1 1.029  1500
n.occ[3,3]    5.036  0.186   5.000   5.000   6.000    FALSE 1 1.000  1500
n.occ[4,3]    4.000  0.000   4.000   4.000   4.000    FALSE 1    NA     1
n.occ[5,3]    5.000  0.000   5.000   5.000   5.000    FALSE 1    NA     1
n.occ[6,3]    3.001  0.037   3.000   3.000   3.000    FALSE 1 1.105  1500
n.occ[7,3]    7.000  0.000   7.000   7.000   7.000    FALSE 1    NA     1
n.occ[8,3]    6.002  0.045   6.000   6.000   6.000    FALSE 1 1.134  1498
z[1,1]        1.039  0.194   1.000   1.000   2.000    FALSE 1 1.001  1500
z[2,1]        1.036  0.186   1.000   1.000   2.000    FALSE 1 1.025   543
z[3,1]        1.069  0.254   1.000   1.000   2.000    FALSE 1 1.004  1411
z[4,1]        3.000  0.000   3.000   3.000   3.000    FALSE 1    NA     1
z[5,1]        1.083  0.275   1.000   1.000   2.000    FALSE 1 1.000  1500
z[6,1]        1.039  0.194   1.000   1.000   2.000    FALSE 1 1.007  1500
z[7,1]        1.029  0.169   1.000   1.000   2.000    FALSE 1 1.007  1500
z[8,1]        1.041  0.198   1.000   1.000   2.000    FALSE 1 0.999  1500
z[9,1]        2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[10,1]       2.001  0.026   2.000   2.000   2.000    FALSE 1 1.291  1500
z[11,1]       1.043  0.204   1.000   1.000   2.000    FALSE 1 1.027   419
z[12,1]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[13,1]       2.001  0.026   2.000   2.000   2.000    FALSE 1 1.291  1500
z[14,1]       1.040  0.196   1.000   1.000   2.000    FALSE 1 0.999  1500
z[15,1]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[16,1]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[17,1]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[18,1]       3.000  0.000   3.000   3.000   3.000    FALSE 1    NA     1
z[19,1]       1.035  0.183   1.000   1.000   2.000    FALSE 1 1.005  1500
z[20,1]       3.000  0.000   3.000   3.000   3.000    FALSE 1    NA     1
z[21,1]       3.000  0.000   3.000   3.000   3.000    FALSE 1    NA     1
z[22,1]       1.036  0.186   1.000   1.000   2.000    FALSE 1 1.006  1500
z[23,1]       1.039  0.193   1.000   1.000   2.000    FALSE 1 1.014   863
z[24,1]       1.085  0.279   1.000   1.000   2.000    FALSE 1 1.001  1500
z[25,1]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[26,1]       1.051  0.219   1.000   1.000   2.000    FALSE 1 0.999  1500
z[27,1]       1.041  0.199   1.000   1.000   2.000    FALSE 1 1.024   494
z[28,1]       2.003  0.058   2.000   2.000   2.000    FALSE 1 1.116  1069
z[29,1]       1.035  0.183   1.000   1.000   2.000    FALSE 1 0.999  1500
z[30,1]       1.038  0.191   1.000   1.000   2.000    FALSE 1 1.002  1500
z[31,1]       1.031  0.174   1.000   1.000   2.000    FALSE 1 1.001  1500
z[32,1]       1.037  0.190   1.000   1.000   2.000    FALSE 1 1.005  1500
z[33,1]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[34,1]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[35,1]       1.039  0.194   1.000   1.000   2.000    FALSE 1 1.004  1500
z[36,1]       1.087  0.281   1.000   1.000   2.000    FALSE 1 1.000  1500
z[37,1]       1.035  0.183   1.000   1.000   2.000    FALSE 1 1.005  1500
z[38,1]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[39,1]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[40,1]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[1,2]        1.013  0.112   1.000   1.000   1.000    FALSE 1 1.005  1500
z[2,2]        1.011  0.103   1.000   1.000   1.000    FALSE 1 1.013  1500
z[3,2]        2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[4,2]        3.000  0.000   3.000   3.000   3.000    FALSE 1    NA     1
z[5,2]        2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[6,2]        1.012  0.109   1.000   1.000   1.000    FALSE 1 1.017  1500
z[7,2]        1.011  0.106   1.000   1.000   1.000    FALSE 1 1.045   901
z[8,2]        1.015  0.120   1.000   1.000   1.000    FALSE 1 1.028  1162
z[9,2]        1.067  0.250   1.000   1.000   2.000    FALSE 1 1.001  1500
z[10,2]       1.029  0.167   1.000   1.000   2.000    FALSE 1 1.034   494
z[11,2]       1.009  0.093   1.000   1.000   1.000    FALSE 1 1.095   523
z[12,2]       1.038  0.191   1.000   1.000   2.000    FALSE 1 1.008  1444
z[13,2]       1.024  0.153   1.000   1.000   1.000    FALSE 1 1.014  1352
z[14,2]       1.019  0.138   1.000   1.000   1.000    FALSE 1 1.009  1500
z[15,2]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[16,2]       1.033  0.180   1.000   1.000   2.000    FALSE 1 1.005  1500
z[17,2]       1.029  0.167   1.000   1.000   2.000    FALSE 1 1.004  1500
z[18,2]       3.000  0.000   3.000   3.000   3.000    FALSE 1    NA     1
z[19,2]       1.011  0.103   1.000   1.000   1.000    FALSE 1 1.007  1500
z[20,2]       3.000  0.000   3.000   3.000   3.000    FALSE 1    NA     1
z[21,2]       3.000  0.000   3.000   3.000   3.000    FALSE 1    NA     1
z[22,2]       1.013  0.115   1.000   1.000   1.000    FALSE 1 1.008  1500
z[23,2]       1.016  0.126   1.000   1.000   1.000    FALSE 1 1.002  1500
z[24,2]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[25,2]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[26,2]       1.017  0.128   1.000   1.000   1.000    FALSE 1 1.012  1500
z[27,2]       1.013  0.115   1.000   1.000   1.000    FALSE 1 1.015  1500
z[28,2]       3.000  0.000   3.000   3.000   3.000    FALSE 1    NA     1
z[29,2]       1.005  0.073   1.000   1.000   1.000    FALSE 1 1.089   919
z[30,2]       1.011  0.103   1.000   1.000   1.000    FALSE 1 1.001  1500
z[31,2]       1.012  0.109   1.000   1.000   1.000    FALSE 1 1.017  1500
z[32,2]       1.011  0.103   1.000   1.000   1.000    FALSE 1 1.045   951
z[33,2]       3.000  0.000   3.000   3.000   3.000    FALSE 1    NA     1
z[34,2]       2.005  0.073   2.000   2.000   2.000    FALSE 1 1.029  1500
z[35,2]       1.013  0.115   1.000   1.000   1.000    FALSE 1 1.015  1500
z[36,2]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[37,2]       1.014  0.118   1.000   1.000   1.000    FALSE 1 1.002  1500
z[38,2]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[39,2]       1.025  0.157   1.000   1.000   1.525    FALSE 1 1.005  1500
z[40,2]       1.024  0.153   1.000   1.000   1.000    FALSE 1 1.004  1500
z[1,3]        1.024  0.153   1.000   1.000   1.000    FALSE 1 1.028   704
z[2,3]        1.013  0.115   1.000   1.000   1.000    FALSE 1 1.023  1500
z[3,3]        1.070  0.255   1.000   1.000   2.000    FALSE 1 0.999  1500
z[4,3]        3.000  0.000   3.000   3.000   3.000    FALSE 1    NA     1
z[5,3]        1.026  0.159   1.000   1.000   2.000    FALSE 1 1.006  1500
z[6,3]        1.015  0.120   1.000   1.000   1.000    FALSE 1 1.013  1500
z[7,3]        1.023  0.149   1.000   1.000   1.000    FALSE 1 1.005  1500
z[8,3]        1.033  0.178   1.000   1.000   2.000    FALSE 1 1.007  1500
z[9,3]        2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[10,3]       1.016  0.126   1.000   1.000   1.000    FALSE 1 1.002  1500
z[11,3]       1.029  0.167   1.000   1.000   2.000    FALSE 1 1.014  1206
z[12,3]       1.013  0.115   1.000   1.000   1.000    FALSE 1 1.019  1500
z[13,3]       1.009  0.093   1.000   1.000   1.000    FALSE 1 1.002  1500
z[14,3]       1.029  0.169   1.000   1.000   2.000    FALSE 1 1.020   812
z[15,3]       1.025  0.155   1.000   1.000   1.000    FALSE 1 1.002  1500
z[16,3]       1.026  0.159   1.000   1.000   2.000    FALSE 1 1.018  1001
z[17,3]       1.009  0.096   1.000   1.000   1.000    FALSE 1 1.017  1500
z[18,3]       3.000  0.000   3.000   3.000   3.000    FALSE 1    NA     1
z[19,3]       1.012  0.109   1.000   1.000   1.000    FALSE 1 1.004  1500
z[20,3]       3.000  0.000   3.000   3.000   3.000    FALSE 1    NA     1
z[21,3]       2.036  0.186   2.000   2.000   3.000    FALSE 1 1.000  1500
z[22,3]       1.024  0.153   1.000   1.000   1.000    FALSE 1 1.003  1500
z[23,3]       1.007  0.081   1.000   1.000   1.000    FALSE 1 1.019  1500
z[24,3]       1.059  0.236   1.000   1.000   2.000    FALSE 1 1.013   652
z[25,3]       1.026  0.159   1.000   1.000   2.000    FALSE 1 1.002  1500
z[26,3]       1.011  0.106   1.000   1.000   1.000    FALSE 1 1.031  1328
z[27,3]       1.011  0.103   1.000   1.000   1.000    FALSE 1 1.001  1500
z[28,3]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[29,3]       1.011  0.106   1.000   1.000   1.000    FALSE 1 1.001  1500
z[30,3]       1.016  0.126   1.000   1.000   1.000    FALSE 1 1.007  1500
z[31,3]       1.015  0.123   1.000   1.000   1.000    FALSE 1 1.003  1500
z[32,3]       1.011  0.106   1.000   1.000   1.000    FALSE 1 1.006  1500
z[33,3]       3.000  0.000   3.000   3.000   3.000    FALSE 1    NA     1
z[34,3]       3.000  0.000   3.000   3.000   3.000    FALSE 1    NA     1
z[35,3]       1.027  0.163   1.000   1.000   2.000    FALSE 1 1.015  1151
z[36,3]       1.032  0.176   1.000   1.000   2.000    FALSE 1 1.008  1500
z[37,3]       1.019  0.138   1.000   1.000   1.000    FALSE 1 1.016  1500
z[38,3]       1.031  0.172   1.000   1.000   2.000    FALSE 1 1.005  1500
z[39,3]       1.028  0.165   1.000   1.000   2.000    FALSE 1    NA  1500
z[40,3]       1.010  0.100   1.000   1.000   1.000    FALSE 1 1.044  1062
z[1,4]        2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[2,4]        1.018  0.133   1.000   1.000   1.000    FALSE 1 1.005  1500
z[3,4]        2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[4,4]        3.000  0.000   3.000   3.000   3.000    FALSE 1    NA     1
z[5,4]        1.006  0.077   1.000   1.000   1.000    FALSE 1 1.067  1119
z[6,4]        1.029  0.167   1.000   1.000   2.000    FALSE 1 1.013  1280
z[7,4]        2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[8,4]        2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[9,4]        1.054  0.226   1.000   1.000   2.000    FALSE 1 1.001  1500
z[10,4]       1.013  0.115   1.000   1.000   1.000    FALSE 1 1.004  1500
z[11,4]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[12,4]       1.033  0.178   1.000   1.000   2.000    FALSE 1 1.007  1500
z[13,4]       1.017  0.128   1.000   1.000   1.000    FALSE 1 1.050   551
z[14,4]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[15,4]       1.009  0.096   1.000   1.000   1.000    FALSE 1 1.065   744
z[16,4]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[17,4]       1.011  0.106   1.000   1.000   1.000    FALSE 1 1.011  1500
z[18,4]       3.000  0.000   3.000   3.000   3.000    FALSE 1    NA     1
z[19,4]       1.015  0.123   1.000   1.000   1.000    FALSE 1 1.017  1500
z[20,4]       1.141  0.348   1.000   1.000   2.000    FALSE 1 1.004   841
z[21,4]       1.033  0.180   1.000   1.000   2.000    FALSE 1 1.005  1500
z[22,4]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[23,4]       1.011  0.106   1.000   1.000   1.000    FALSE 1 1.080   486
z[24,4]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[25,4]       1.013  0.112   1.000   1.000   1.000    FALSE 1 1.025  1482
z[26,4]       1.014  0.118   1.000   1.000   1.000    FALSE 1 1.029  1151
z[27,4]       1.018  0.133   1.000   1.000   1.000    FALSE 1 1.054   474
z[28,4]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[29,4]       1.009  0.096   1.000   1.000   1.000    FALSE 1 1.065   744
z[30,4]       1.015  0.120   1.000   1.000   1.000    FALSE 1 1.025  1302
z[31,4]       1.016  0.126   1.000   1.000   1.000    FALSE 1 1.032   909
z[32,4]       1.013  0.112   1.000   1.000   1.000    FALSE 1 1.017  1500
z[33,4]       3.000  0.000   3.000   3.000   3.000    FALSE 1    NA     1
z[34,4]       3.000  0.000   3.000   3.000   3.000    FALSE 1    NA     1
z[35,4]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[36,4]       1.009  0.096   1.000   1.000   1.000    FALSE 1 1.096   485
z[37,4]       1.283  0.451   1.000   1.000   2.000    FALSE 1 1.000  1500
z[38,4]       1.011  0.106   1.000   1.000   1.000    FALSE 1 1.050   814
z[39,4]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[40,4]       1.014  0.118   1.000   1.000   1.000    FALSE 1 1.029  1151
z[1,5]        1.074  0.262   1.000   1.000   2.000    FALSE 1 1.001  1500
z[2,5]        1.013  0.112   1.000   1.000   1.000    FALSE 1 1.037  1006
z[3,5]        1.026  0.159   1.000   1.000   2.000    FALSE 1 1.018  1001
z[4,5]        3.000  0.000   3.000   3.000   3.000    FALSE 1    NA     1
z[5,5]        1.015  0.120   1.000   1.000   1.000    FALSE 1 1.013  1500
z[6,5]        2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[7,5]        2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[8,5]        1.026  0.159   1.000   1.000   2.000    FALSE 1 1.012  1462
z[9,5]        2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[10,5]       1.013  0.112   1.000   1.000   1.000    FALSE 1 1.000  1500
z[11,5]       1.030  0.171   1.000   1.000   2.000    FALSE 1 1.027   591
z[12,5]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[13,5]       1.016  0.126   1.000   1.000   1.000    FALSE 1 1.010  1500
z[14,5]       1.030  0.171   1.000   1.000   2.000    FALSE 1 1.015  1040
z[15,5]       1.012  0.109   1.000   1.000   1.000    FALSE 1 1.056   685
z[16,5]       1.027  0.161   1.000   1.000   2.000    FALSE 1 1.032   568
z[17,5]       1.013  0.112   1.000   1.000   1.000    FALSE 1 1.005  1500
z[18,5]       3.000  0.000   3.000   3.000   3.000    FALSE 1    NA     1
z[19,5]       1.014  0.118   1.000   1.000   1.000    FALSE 1 1.002  1500
z[20,5]       1.018  0.133   1.000   1.000   1.000    FALSE 1 1.024  1106
z[21,5]       1.013  0.112   1.000   1.000   1.000    FALSE 1 1.041   909
z[22,5]       1.027  0.163   1.000   1.000   2.000    FALSE 1 1.008  1500
z[23,5]       1.014  0.118   1.000   1.000   1.000    FALSE 1 1.051   648
z[24,5]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[25,5]       1.012  0.109   1.000   1.000   1.000    FALSE 1 1.052   742
z[26,5]       1.015  0.120   1.000   1.000   1.000    FALSE 1 1.016  1500
z[27,5]       1.025  0.157   1.000   1.000   1.525    FALSE 1 1.000  1500
z[28,5]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[29,5]       1.017  0.131   1.000   1.000   1.000    FALSE 1 1.047   573
z[30,5]       1.011  0.106   1.000   1.000   1.000    FALSE 1 1.045   901
z[31,5]       1.012  0.109   1.000   1.000   1.000    FALSE 1 1.031  1271
z[32,5]       1.016  0.126   1.000   1.000   1.000    FALSE 1 1.010  1500
z[33,5]       3.000  0.000   3.000   3.000   3.000    FALSE 1    NA     1
z[34,5]       3.000  0.000   3.000   3.000   3.000    FALSE 1    NA     1
z[35,5]       1.031  0.172   1.000   1.000   2.000    FALSE 1 1.000  1500
z[36,5]       1.030  0.171   1.000   1.000   2.000    FALSE 1 1.000  1500
z[37,5]       3.000  0.000   3.000   3.000   3.000    FALSE 1    NA     1
z[38,5]       1.014  0.118   1.000   1.000   1.000    FALSE 1 1.023  1480
z[39,5]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[40,5]       1.012  0.109   1.000   1.000   1.000    FALSE 1 1.017  1500
z[1,6]        2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[2,6]        1.012  0.109   1.000   1.000   1.000    FALSE 1 1.013  1500
z[3,6]        1.011  0.103   1.000   1.000   1.000    FALSE 1 1.024  1500
z[4,6]        3.000  0.000   3.000   3.000   3.000    FALSE 1    NA     1
z[5,6]        1.010  0.100   1.000   1.000   1.000    FALSE 1 1.044  1062
z[6,6]        2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[7,6]        1.021  0.145   1.000   1.000   1.000    FALSE 1 1.012  1500
z[8,6]        1.014  0.118   1.000   1.000   1.000    FALSE 1 1.060   546
z[9,6]        1.025  0.155   1.000   1.000   1.000    FALSE 1 1.010  1500
z[10,6]       1.008  0.089   1.000   1.000   1.000    FALSE 1 1.029  1500
z[11,6]       1.011  0.106   1.000   1.000   1.000    FALSE 1 1.041  1009
z[12,6]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[13,6]       1.008  0.089   1.000   1.000   1.000    FALSE 1 1.039  1489
z[14,6]       1.015  0.123   1.000   1.000   1.000    FALSE 1 1.059   508
z[15,6]       1.012  0.109   1.000   1.000   1.000    FALSE 1 1.004  1500
z[16,6]       1.009  0.096   1.000   1.000   1.000    FALSE 1 1.009  1500
z[17,6]       1.032  0.176   1.000   1.000   2.000    FALSE 1 1.007  1500
z[18,6]       2.001  0.026   2.000   2.000   2.000    FALSE 1 1.291  1500
z[19,6]       1.027  0.163   1.000   1.000   2.000    FALSE 1 1.023   758
z[20,6]       1.029  0.169   1.000   1.000   2.000    FALSE 1 1.001  1500
z[21,6]       1.009  0.096   1.000   1.000   1.000    FALSE 1 1.045  1096
z[22,6]       1.017  0.128   1.000   1.000   1.000    FALSE 1 1.021  1318
z[23,6]       1.008  0.089   1.000   1.000   1.000    FALSE 1 1.009  1500
z[24,6]       1.079  0.270   1.000   1.000   2.000    FALSE 1 1.007   827
z[25,6]       1.008  0.089   1.000   1.000   1.000    FALSE 1 1.029  1500
z[26,6]       1.015  0.120   1.000   1.000   1.000    FALSE 1 1.019  1500
z[27,6]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[28,6]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[29,6]       1.011  0.106   1.000   1.000   1.000    FALSE 1 1.021  1500
z[30,6]       1.011  0.103   1.000   1.000   1.000    FALSE 1 1.056   767
z[31,6]       1.017  0.128   1.000   1.000   1.000    FALSE 1 1.002  1500
z[32,6]       1.009  0.096   1.000   1.000   1.000    FALSE 1 1.071   672
z[33,6]       1.119  0.324   1.000   1.000   2.000    FALSE 1 1.002  1500
z[34,6]       3.000  0.000   3.000   3.000   3.000    FALSE 1    NA     1
z[35,6]       1.011  0.103   1.000   1.000   1.000    FALSE 1 1.066   643
z[36,6]       2.001  0.026   2.000   2.000   2.000    FALSE 1 1.291  1500
z[37,6]       3.000  0.000   3.000   3.000   3.000    FALSE 1    NA     1
z[38,6]       1.014  0.118   1.000   1.000   1.000    FALSE 1 1.023  1480
z[39,6]       1.039  0.193   1.000   1.000   2.000    FALSE 1 1.013   920
z[40,6]       1.013  0.112   1.000   1.000   1.000    FALSE 1 1.041   909
z[1,7]        1.016  0.126   1.000   1.000   1.000    FALSE 1 1.002  1500
z[2,7]        1.012  0.109   1.000   1.000   1.000    FALSE 1 1.056   685
z[3,7]        1.012  0.109   1.000   1.000   1.000    FALSE 1 1.004  1500
z[4,7]        3.000  0.000   3.000   3.000   3.000    FALSE 1    NA     1
z[5,7]        1.017  0.128   1.000   1.000   1.000    FALSE 1 1.002  1500
z[6,7]        2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[7,7]        1.008  0.089   1.000   1.000   1.000    FALSE 1 1.066   851
z[8,7]        1.014  0.118   1.000   1.000   1.000    FALSE 1 1.009  1500
z[9,7]        1.010  0.100   1.000   1.000   1.000    FALSE 1 1.055   826
z[10,7]       1.015  0.120   1.000   1.000   1.000    FALSE 1 1.072   429
z[11,7]       1.025  0.155   1.000   1.000   1.000    FALSE 1 1.018  1042
z[12,7]       3.000  0.000   3.000   3.000   3.000    FALSE 1    NA     1
z[13,7]       1.019  0.138   1.000   1.000   1.000    FALSE 1 1.007  1500
z[14,7]       1.017  0.128   1.000   1.000   1.000    FALSE 1 1.010  1500
z[15,7]       1.026  0.159   1.000   1.000   2.000    FALSE 1 1.000  1500
z[16,7]       1.009  0.096   1.000   1.000   1.000    FALSE 1 1.017  1500
z[17,7]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[18,7]       3.000  0.000   3.000   3.000   3.000    FALSE 1    NA     1
z[19,7]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[20,7]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[21,7]       1.025  0.157   1.000   1.000   1.525    FALSE 1 1.022   869
z[22,7]       1.015  0.120   1.000   1.000   1.000    FALSE 1 1.016  1500
z[23,7]       1.011  0.103   1.000   1.000   1.000    FALSE 1 1.024  1500
z[24,7]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[25,7]       1.029  0.169   1.000   1.000   2.000    FALSE 1 1.003  1500
z[26,7]       1.013  0.112   1.000   1.000   1.000    FALSE 1 1.080   441
z[27,7]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[28,7]       3.000  0.000   3.000   3.000   3.000    FALSE 1    NA     1
z[29,7]       1.019  0.135   1.000   1.000   1.000    FALSE 1 1.007  1500
z[30,7]       1.011  0.106   1.000   1.000   1.000    FALSE 1 1.011  1500
z[31,7]       1.027  0.161   1.000   1.000   2.000    FALSE 1 1.001  1500
z[32,7]       1.011  0.106   1.000   1.000   1.000    FALSE 1 1.076   516
z[33,7]       1.013  0.112   1.000   1.000   1.000    FALSE 1 1.021  1500
z[34,7]       3.000  0.000   3.000   3.000   3.000    FALSE 1    NA     1
z[35,7]       1.021  0.145   1.000   1.000   1.000    FALSE 1 1.000  1500
z[36,7]       3.000  0.000   3.000   3.000   3.000    FALSE 1    NA     1
z[37,7]       3.000  0.000   3.000   3.000   3.000    FALSE 1    NA     1
z[38,7]       1.027  0.161   1.000   1.000   2.000    FALSE 1 1.000  1500
z[39,7]       1.010  0.100   1.000   1.000   1.000    FALSE 1 1.006  1500
z[40,7]       1.013  0.112   1.000   1.000   1.000    FALSE 1 1.017  1500
z[1,8]        1.017  0.128   1.000   1.000   1.000    FALSE 1 1.010  1500
z[2,8]        1.009  0.096   1.000   1.000   1.000    FALSE 1 1.065   744
z[3,8]        1.011  0.106   1.000   1.000   1.000    FALSE 1 1.045   901
z[4,8]        3.000  0.000   3.000   3.000   3.000    FALSE 1    NA     1
z[5,8]        1.023  0.151   1.000   1.000   1.000    FALSE 1 1.005  1500
z[6,8]        1.037  0.190   1.000   1.000   2.000    FALSE 1 0.999  1500
z[7,8]        1.023  0.151   1.000   1.000   1.000    FALSE 1 1.017  1193
z[8,8]        1.018  0.133   1.000   1.000   1.000    FALSE 1 1.007  1500
z[9,8]        1.020  0.140   1.000   1.000   1.000    FALSE 1 1.014  1500
z[10,8]       1.017  0.128   1.000   1.000   1.000    FALSE 1 1.000  1500
z[11,8]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[12,8]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[13,8]       1.015  0.123   1.000   1.000   1.000    FALSE 1 1.033   919
z[14,8]       1.015  0.120   1.000   1.000   1.000    FALSE 1 1.006  1500
z[15,8]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[16,8]       1.010  0.100   1.000   1.000   1.000    FALSE 1 1.019  1500
z[17,8]       1.036  0.186   1.000   1.000   2.000    FALSE 1 1.001  1500
z[18,8]       3.000  0.000   3.000   3.000   3.000    FALSE 1    NA     1
z[19,8]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[20,8]       1.037  0.188   1.000   1.000   2.000    FALSE 1 1.011  1187
z[21,8]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[22,8]       1.014  0.118   1.000   1.000   1.000    FALSE 1    NA  1500
z[23,8]       1.020  0.140   1.000   1.000   1.000    FALSE 1 1.011  1500
z[24,8]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[25,8]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[26,8]       1.012  0.109   1.000   1.000   1.000    FALSE 1 1.004  1500
z[27,8]       1.044  0.205   1.000   1.000   2.000    FALSE 1 1.000  1500
z[28,8]       3.000  0.000   3.000   3.000   3.000    FALSE 1    NA     1
z[29,8]       1.015  0.120   1.000   1.000   1.000    FALSE 1 1.069   446
z[30,8]       1.016  0.126   1.000   1.000   1.000    FALSE 1 1.047   622
z[31,8]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[32,8]       1.015  0.120   1.000   1.000   1.000    FALSE 1 1.006  1500
z[33,8]       1.020  0.140   1.000   1.000   1.000    FALSE 1 1.030   775
z[34,8]       3.000  0.000   3.000   3.000   3.000    FALSE 1    NA     1
z[35,8]       2.000  0.000   2.000   2.000   2.000    FALSE 1    NA     1
z[36,8]       3.000  0.000   3.000   3.000   3.000    FALSE 1    NA     1
z[37,8]       3.000  0.000   3.000   3.000   3.000    FALSE 1    NA     1
z[38,8]       2.002  0.045   2.000   2.000   2.000    FALSE 1 1.134  1498
z[39,8]       1.021  0.145   1.000   1.000   1.000    FALSE 1 1.013  1500
z[40,8]       1.021  0.142   1.000   1.000   1.000    FALSE 1 1.037   625
deviance    563.759 14.570 539.256 562.245 595.696    FALSE 1 1.000  1500

**WARNING** Rhat values indicate convergence failure. 
Rhat is the potential scale reduction factor (at convergence, Rhat=1). 
For each parameter, n.eff is a crude measure of effective sample size. 

overlap0 checks if 0 falls in the parameter's 95% credible interval.
f is the proportion of the posterior with the same sign as the mean;
i.e., our confidence that the parameter is positive or negative.

DIC info: (pD = var(deviance)/2) 
pD = 106.3 and DIC = 670.034 
DIC is an estimate of expected predictive error (lower is better).</code></pre>
</div>
</div>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>